/*! For license information please see 2.js.LICENSE.txt */
(this["webpackJsonpPluginswag-publisher"]=this["webpackJsonpPluginswag-publisher"]||[]).push([[2],{"38Lh":function(e,t,n){"use strict";n.r(t);n("x58b");function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){r=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function d(e,t,n,a){var r=t&&t.prototype instanceof f?t:f,i=Object.create(r.prototype),s=new L(a||[]);return o(i,"_invoke",{value:k(e,n,s)}),i}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var h={};function f(){}function v(){}function m(){}var g={};u(g,s,(function(){return this}));var b=Object.getPrototypeOf,w=b&&b(b(C([])));w&&w!==t&&n.call(w,s)&&(g=w);var y=m.prototype=f.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,i,s,c){var l=p(e[o],e,i);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==a(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,c)}))}c(l.arg)}var i;o(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return i=i?i.then(a,a):a()}})}function k(e,t,n){var a="suspendedStart";return function(r,o){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw o;return M()}for(n.method=r,n.arg=o;;){var i=n.delegate;if(i){var s=S(i,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=p(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}function S(e,t){var n=t.method,a=e.iterator[n];if(void 0===a)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var r=p(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function C(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:M}}function M(){return{value:void 0,done:!0}}return v.prototype=m,o(y,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:v,configurable:!0}),v.displayName=u(m,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},_(x.prototype),u(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,a,r,o){void 0===o&&(o=Promise);var i=new x(d(t,n,a,r),o);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},_(y),u(y,l,"Generator"),u(y,s,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=C,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return i.type="throw",i.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;D(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function o(e,t,n,a,r,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function s(e){o(i,a,r,s,c,"next",e)}function c(e){o(i,a,r,s,c,"throw",e)}s(void 0)}))}}var s=Shopware,c=s.Component,l=s.Mixin,u=Shopware.Data.Criteria;t.default=c.wrapComponentConfig({template:'{% block sw_cms_detail_toolbar_back_button %}\n    <span\n        class="sw-cms-detail__back-btn publisher__custom-link"\n        @click="onCloseClick"\n    >\n        <sw-icon name="regular-times"></sw-icon>\n    </span>\n{% endblock %}\n\n{% block sw_cms_detail_toolbar_page_type %}\n    {% parent %}\n\n    <div\n        v-if="isEntityDraft"\n        class="publisher-cms-detail--is-draft"\n    >\n        {{ $tc(\'publisher.listing.draft\') }}\n    </div>\n{% endblock %}\n\n{% block sw_cms_detail_toolbar_actions %}\n    <template #preview>\n        <sw-button\n            v-if="isEntityDraft"\n            :isLoading="isLoadingPreview"\n            variant="ghost"\n            @click="onPreviewClick"\n            v-tooltip="{ message: $tc(\'publisher.detail.previewTooltip\') }"\n        >\n            {{ $tc(\'publisher.detail.preview\') }}\n        </sw-button>\n    </template>\n\n    <template #activity>\n        <publisher-activity-stack v-if="page.extensions" />\n    </template>\n\n    {% parent %}\n{% endblock %}\n\n{% block sw_cms_detail_toolbar_actions_save %}\n    <template v-if="page.locked">\n        {% parent %}\n    </template>\n\n    <sw-button-group\n        v-else\n        class="sw-product-detail__save-button-group"\n        :splitButton="true"\n    >\n        {% block publisher_cms_detail_toolbar_actions_save %}\n            <sw-button-process\n                class="sw-cms-detail__save-action"\n                :isLoading="isLoading"\n                :processSuccess="isSaveSuccessful"\n                :disabled="isLoading || page.locked || !acl.can(\'cms.editor\') || (isEntityDraft && !acl.can(\'cms_page_draft:update\'))"\n                variant="primary"\n                @process-finish="saveFinish"\n                v-tooltip.bottom="tooltipSave"\n                @click="onSaveClick"\n            >\n                {{ $tc(\'publisher.detail.action.save\') }}\n            </sw-button-process>\n        {% endblock %}\n\n        {% block publisher_cms_detail_toolbar_actions_context %}\n            <sw-context-button>\n                {% block publisher_cms_detail_toolbar_actions_context_toggle %}\n                    <template slot="button">\n                        <sw-button\n                            square\n                            variant="primary"\n                            :disabled="isLoading"\n                        >\n                            <sw-icon\n                                name="regular-chevron-down-s"\n                                size="20"\n                            />\n                        </sw-button>\n                    </template>\n                {% endblock %}\n\n                {% block publisher_cms_detail_toolbar_actions_context_save_draft %}\n                    <sw-context-menu-item\n                        @click="onSaveDraft"\n                        :disabled="isEntityDraft || !acl.can(\'cms_page_draft:create\')"\n                    >\n                        {{ $tc(\'publisher.detail.action.saveDraft\') }}\n                    </sw-context-menu-item>\n                {% endblock %}\n\n                {% block publisher_cms_detail_toolbar_actions_context_save_assign %}\n                    <sw-context-menu-item\n                        :disabled="!isEntityDraft || !acl.can(\'cms_page_draft:delete\') || !acl.can(\'cms.creator\')"\n                        class="sw-product-detail__save-duplicate-action"\n                        @click="onSavePublish"\n                    >\n                        {{ $tc(\'publisher.detail.action.saveAssign\') }}\n                    </sw-context-menu-item>\n                {% endblock %}\n            </sw-context-button>\n        {% endblock %}\n    </sw-button-group>\n{% endblock %}\n\n{% block sw_cms_detail_stage_container %}\n    {% parent %}\n\n    {% block publisher_cms_detail_modals %}\n\n        {% block publisher_cms_detail_modals_unsaved %}\n            <sw-modal\n                v-if="showModalUnsaved"\n                :title="$tc(\'publisher.detail.modal.titleUnsaved\')"\n                @modal-close="showModalUnsaved = false"\n                class="publisher__modal"\n                size="600px"\n            >\n                <template>\n                    <p>{{ $tc(\'publisher.detail.modal.unsavedLineInformation\') }}</p>\n                    <br>\n                    <p><b>{{ $tc(\'publisher.detail.modal.unsavedLineConfirmation\') }}</b></p>\n                </template>\n\n                <template #modal-footer>\n                    <sw-button\n                        @click="onDiscard"\n                        class="left"\n                    >\n                        {{ $tc(\'publisher.detail.modal.discard\') }}\n                    </sw-button>\n                    <sw-button\n                        v-if="!isEntityDraft"\n                        @click="onModalSaveDraft"\n                        variant="ghost"\n                        :disabled="!acl.can(\'cms_page_draft:create\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.saveAsDraft\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="onModalSaveLayout"\n                        variant="primary"\n                        :disabled="!acl.can(\'cms.editor\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.save\') }}\n                    </sw-button>\n                </template>\n            </sw-modal>\n        {% endblock %}\n\n        {% block publisher_cms_detail_modals_draft_name %}\n            <sw-modal\n                v-if="showModalDraftName"\n                :title="$tc(\'publisher.detail.modal.titleSaveDraft\')"\n                @modal-close="showModalDraftName = false"\n                class="publisher__modal"\n                variant="small"\n            >\n                <template>\n                    <p>{{ $tc(\'publisher.detail.modal.saveDraftInformation\') }}</p>\n\n                    <sw-text-field\n                        :value="draftName"\n                        :label="$tc(\'publisher.detail.modal.saveDraftLabelName\')"\n                        @input="setDraftName"\n                        class="publisher__modal-input--draft-name"\n                    ></sw-text-field>\n                </template>\n\n                <template #modal-footer>\n                    <sw-button\n                        @click="showModalDraftName = false"\n                        class="left"\n                    >\n                        {{ $tc(\'publisher.detail.modal.cancel\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="onModalDraftNameConfirm"\n                        :disabled="!draftName.length || !acl.can(\'cms_page_draft:create\')"\n                        variant="primary"\n                    >\n                        {{ $tc(\'publisher.detail.modal.saveDraftConfirmation\') }}\n                    </sw-button>\n                </template>\n            </sw-modal>\n        {% endblock %}\n\n        {% block publisher_cms_detail_modals_save_and_publish %}\n            <sw-modal\n                v-if="showModalPublish"\n                :title="$tc(\'publisher.detail.modal.titlePublish\')"\n                @modal-close="showModalPublish = false"\n                class="publisher__modal"\n                variant="large"\n            >\n                <template>\n                    <div class="publisher__modal-info">\n                        <sw-icon\n                            name="regular-info-circle"\n                            size="18"\n                        ></sw-icon>\n                        {{ $tc(\'publisher.detail.modal.publishAffectedCategories\', page.categories.length) }}\n                    </div>\n                    <p>{{ $tc(\'publisher.detail.modal.publishInformation\') }}</p>\n                    <br>\n                    <p><b>{{ $tc(\'publisher.detail.modal.publishConfirmation\') }}</b></p>\n                </template>\n\n                <template #modal-footer>\n                    <sw-button\n                        @click="onDiscard"\n                        class="left"\n                    >\n                        {{ $tc(\'publisher.detail.modal.discard\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="onModalSaveDraft"\n                        variant="ghost"\n                        :disabled="isEntityDraft || !acl.can(\'cms_page_draft:create\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.saveAsDraft\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="onModalSavePublish"\n                        variant="primary"\n                        :disabled="!isEntityDraft || !acl.can(\'cms_page_draft:create\') || !acl.can(\'cms.creator\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.saveAndPublish\') }}\n                    </sw-button>\n                </template>\n            </sw-modal>\n        {% endblock %}\n\n        {% block publisher_cms_detail_modals_parent_changes %}\n            <sw-modal\n                v-if="showModalParentChanges"\n                :title="$tc(\'publisher.detail.modal.titleParentChanges\')"\n                @modal-close="showModalParentChanges = false"\n                class="publisher__modal"\n            >\n                <template>\n                    <div class="publisher__modal-info publisher__modal-info--warning">\n                        <sw-icon\n                            name="regular-exclamation-triangle"\n                            size="18"\n                        ></sw-icon>\n                        {{ $tc(\'publisher.detail.modal.infoParentChanges\') }}\n                    </div>\n                    <p>{{ $tc(\'publisher.detail.modal.descriptionParentChanges\') }}</p>\n                </template>\n\n                <template #modal-footer>\n                    <sw-button\n                        @click="onModalUpdateFromParent"\n                        class="left"\n                        :disabled="!acl.can(\'cms_page_draft:update\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.buttonUpdateFromParent\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="onModalSaveNewLayout"\n                        variant="ghost"\n                        :disabled="!acl.can(\'cms.creator\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.buttonCreateNewLayout\') }}\n                    </sw-button>\n                    <sw-button\n                        @click="showModalParentChanges = false"\n                        variant="primary"\n                        :disabled="!acl.can(\'cms_page_draft:create\')"\n                    >\n                        {{ $tc(\'publisher.detail.modal.buttonSaveAsNewDraft\') }}\n                    </sw-button>\n                </template>\n            </sw-modal>\n        {% endblock %}\n    {% endblock %}\n{% endblock %}\n',inject:["draftApiService","repositoryFactory"],mixins:[l.getByName("sw-publisher-draft")],data:function(){return{pageId:null,pageOrigin:null,page:{sections:[]},salesChannels:[],isLoading:!1,isSaveSuccessful:!1,currentSalesChannelKey:null,selectedBlockSectionId:null,currentMappingEntity:null,currentMappingEntityRepo:null,demoEntityId:null,showModalUnsaved:!1,showModalDraftName:!1,showModalPublish:!1,showModalParentChanges:!1,draftName:"",isLoadingPreview:!1,initialLoadDone:!1}},watch:{page:{deep:!0,handler:function(){this.initialLoadDone||(this.initialLoadDone=!0,this.checkForParentUpdate())}}},computed:{pageRepository:function(){var e=this,t=this.repositoryFactory.create("cms_page");return t._get=t.get,t._save=t.save,t.save=function(n){return t._save(n,e.getVersionContext())},t.get=function(n,a,r){return t._get(n,e.getVersionContext(),r)},t},draftVersionId:function(){return Shopware.State.get("sw-publisher").versionId},draft:function(){return Shopware.State.get("sw-publisher").draft},salesChannelRepository:function(){return this.repositoryFactory.create("sales_channel")},loadPageCriteria:function(){var e=new u(1,1),t=u.sort("position","ASC",!0),n=u.sort("createdAt","DESC");return e.addAssociation("categories"),this.acl.can("cms_page_activity:read")&&(e.addAssociation("activities"),e.getAssociation("activities").addSorting(n)),this.isEntityDraft&&this.acl.can("cms_page_draft:read")&&(e.addAssociation("drafts"),e.getAssociation("drafts").addFilter(u.equals("draftVersion",this.draftVersionId))),e.getAssociation("sections").addSorting(t).addAssociation("backgroundMedia").getAssociation("blocks").addSorting(t).addAssociation("backgroundMedia").addAssociation("slots"),e}},methods:{beforeDestroyedComponent:function(){Shopware.State.commit("cmsPageState/removeCurrentPage"),Shopware.State.commit("cmsPageState/removeSelectedBlock"),Shopware.State.commit("cmsPageState/removeSelectedSection"),Shopware.State.dispatch("sw-publisher/resetDetailStates")},resolvePublisherData:function(){Shopware.State.commit("sw-publisher/setDraft",this.page.extensions.drafts[0]),Shopware.State.commit("sw-publisher/setActivity",this.page.extensions.activities),Shopware.State.dispatch("sw-publisher/enrichActivity",this.repositoryFactory.create("user"))},resolveCmsData:function(){var e=this;return i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.cmsDataResolverService.resolve(e.page);case 3:e.updateSectionAndBlockPositions(),Shopware.State.commit("cmsPageState/setCurrentPage",e.page),e.updateDataMapping(),e.pageOrigin=Shopware.Utils.object.cloneDeep(e.page),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),e.createNotificationError({title:t.t0.message,message:t.t0.response}),warn(e._name,t.t0.message,t.t0.response);case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))()},loadPage:function(e){var t=this;return i(r().mark((function n(){return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t.isLoading=!0,n.next=4,t.pageRepository.get(e,Shopware.Context.api,t.loadPageCriteria);case 4:return t.page=n.sent,n.next=7,t.resolveCmsData();case 7:t.resolvePublisherData(),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),t.createNotificationError({title:n.t0.message,message:n.t0.response.statusText});case 13:return n.prev=13,t.isLoading=!1,n.finish(13);case 16:case"end":return n.stop()}}),n,null,[[0,10,13,16]])})))()},saveDraft:function(){var e=this;return i(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoading=!0,t.next=4,e.draftApiService.saveAsDraft(e.page,e.draftName);case 4:return n=t.sent,t.next=7,e.openDetailPage(e.page.id,n);case 7:return t.next=9,e.loadPage(e.page.id);case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error(t.t0),void 0!==n||e.onError("publisher.error.action.draft");case 15:return t.prev=15,e.draftName="",e.isLoading=!1,t.finish(15);case 19:case"end":return t.stop()}}),t,null,[[0,11,15,19]])})))()},saveAsNewDraftAndClose:function(){var e=this;return i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoading=!0,t.next=4,e.onSave();case 4:return t.next=6,e.draftApiService.saveAsDraft(e.page,e.draftName);case 6:e.closeDetailPage(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.onError("publisher.error.action.draft");case 12:return t.prev=12,e.draftName="",e.isLoading=!1,t.finish(12);case 16:case"end":return t.stop()}}),t,null,[[0,9,12,16]])})))()},saveAndPublish:function(){var e=this;return i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.onSave();case 3:return e.isLoading=!0,t.next=6,e.draftApiService.merge(e.draft,e.page);case 6:e.getLayout(e.page.id),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),e.onError("publisher.error.action.saveAndPublish");case 12:return t.prev=12,e.isLoading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,9,12,15]])})))()},releaseAsNew:function(){var e=this;return i(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoading=!0,t.next=4,e.draftApiService.releaseAsNew(e.draft,e.page);case 4:n=t.sent,e.getLayout(n),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),e.onError("publisher.error.action.createNewLayout");case 11:return t.prev=11,e.isLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[0,8,11,14]])})))()},updateFromParent:function(){var e=this;return i(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoading=!0,t.next=4,e.draftApiService.updateFromLiveVersion(e.draft,e.page);case 4:return n=t.sent,t.next=7,e.getLayout(e.page.id,n);case 7:return t.next=9,e.loadPage(e.page.id);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),e.onError("publisher.error.action.updateFromParent");case 14:return t.prev=14,e.isLoading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[0,11,14,17]])})))()},createDraftName:function(){return"".concat(this.page.name,"-").concat(this.getCurrentDate())},getCurrentDate:function(){var e=new Date,t=""+(e.getMonth()+1),n=""+e.getDate(),a=e.getFullYear();return t.length<2&&(t="0"+t),n.length<2&&(n="0"+n),[a,t,n].join("-")},onError:function(e){this.createNotificationError({title:this.$tc("publisher.error.title"),message:this.$tc(e)})},onCloseClick:function(){!this.page.locked&&this.entityHasChanged(this.page,this.pageOrigin)?this.showModalUnsaved=!0:this.closeDetailPage()},onModalSaveDraft:function(){var e=this;this.showModalUnsaved=!1,this.showModalPublish=!1,this.$nextTick(i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.saveAsNewDraftAndClose();case 2:case"end":return t.stop()}}),t)}))))},onModalSaveLayout:function(){var e=this;this.showModalUnsaved=!1,this.$nextTick(i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onSave();case 2:e.closeDetailPage();case 3:case"end":return t.stop()}}),t)}))))},closeDetailPage:function(){this.$router.push({name:"sw.cms.index"})},onDiscard:function(){this.showModalUnsaved=!1,this.showModalPublish=!1,this.$nextTick(this.closeDetailPage)},onSaveDraft:function(){this.draftName=this.createDraftName(),this.showModalDraftName=!0},setDraftName:function(e){this.draftName=e},onModalDraftNameConfirm:function(){this.showModalDraftName=!1,this.$nextTick(this.saveDraft)},onSavePublish:function(){this.page.categories.length?this.showModalPublish=!0:this.saveAndPublish()},onModalSavePublish:function(){var e=this;this.showModalPublish=!1,this.$nextTick(i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isEntityDraft){t.next=4;break}e.saveAndPublish(),t.next=6;break;case 4:return t.next=6,e.onSave();case 6:case"end":return t.stop()}}),t)}))))},onSaveClick:function(){this.onSave()},checkForParentUpdate:function(){var e=this;return i(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.entityParentUpdated(e.page);case 2:e.showModalParentChanges=t.sent;case 3:case"end":return t.stop()}}),t)})))()},onModalUpdateFromParent:function(){this.showModalParentChanges=!1,this.$nextTick(this.updateFromParent)},onModalSaveNewLayout:function(){this.showModalParentChanges=!1,this.$nextTick(this.releaseAsNew)},onPreviewClick:function(){var e=this;return i(r().mark((function t(){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.isLoadingPreview=!0,t.next=4,e.getSalesChannelUrl();case 4:n=t.sent,window.open("".concat(n,"/draft/preview/").concat(e.draft.deepLinkCode),"_blank");case 6:return t.prev=6,e.isLoadingPreview=!1,t.finish(6);case 9:case"end":return t.stop()}}),t,null,[[0,,6,9]])})))()},getSalesChannelUrl:function(){var e=this;return i(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,(n=new u(1,1)).addAssociation("domains"),n.addFilter(u.multi("AND",[u.equals("typeId",Shopware.Defaults.storefrontSalesChannelTypeId),u.not("AND",[u.equals("domains.url",null)])])),t.next=6,e.salesChannelRepository.search(n,Shopware.Context.api);case 6:return a=t.sent,t.abrupt("return",a[0].domains[0].url);case 10:t.prev=10,t.t0=t.catch(0),e.onError("publisher.error.action.getSalesChannelUrl");case 13:case"end":return t.stop()}}),t,null,[[0,10]])})))()},getLayout:function(e){var t=arguments,n=this;return i(r().mark((function a(){var o;return r().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=t.length>1&&void 0!==t[1]?t[1]:null,a.next=3,n.openDetailPage(e,o);case 3:n.loadPage(e);case 4:case"end":return a.stop()}}),a)})))()}}})},C7Lo:function(e,t,n){},P8hj:function(e,t,n){"use strict";function a(e,t){for(var n=[],a={},r=0;r<t.length;r++){var o=t[r],i=o[0],s={id:e+":"+r,css:o[1],media:o[2],sourceMap:o[3]};a[i]?a[i].parts.push(s):n.push(a[i]={id:i,parts:[s]})}return n}n.r(t),n.d(t,"default",(function(){return f}));var r="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!r)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},i=r&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,l=!1,u=function(){},d=null,p="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,n,r){l=n,d=r||{};var i=a(e,t);return v(i),function(t){for(var n=[],r=0;r<i.length;r++){var s=i[r];(c=o[s.id]).refs--,n.push(c)}t?v(i=a(e,t)):i=[];for(r=0;r<n.length;r++){var c;if(0===(c=n[r]).refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete o[c.id]}}}}function v(e){for(var t=0;t<e.length;t++){var n=e[t],a=o[n.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](n.parts[r]);for(;r<n.parts.length;r++)a.parts.push(g(n.parts[r]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var i=[];for(r=0;r<n.parts.length;r++)i.push(g(n.parts[r]));o[n.id]={id:n.id,refs:1,parts:i}}}}function m(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function g(e){var t,n,a=document.querySelector("style["+p+'~="'+e.id+'"]');if(a){if(l)return u;a.parentNode.removeChild(a)}if(h){var r=c++;a=s||(s=m()),t=y.bind(null,a,r,!1),n=y.bind(null,a,r,!0)}else a=m(),t=_.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var b,w=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function y(e,t,n,a){var r=n?"":a.css;if(e.styleSheet)e.styleSheet.cssText=w(t,r);else{var o=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(o,i[t]):e.appendChild(o)}}function _(e,t){var n=t.css,a=t.media,r=t.sourceMap;if(a&&e.setAttribute("media",a),d.ssrId&&e.setAttribute(p,t.id),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},x58b:function(e,t,n){var a=n("C7Lo");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("P8hj").default)("35460ff8",a,!0,{})}}]);
//# sourceMappingURL=2.js.map