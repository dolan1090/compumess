<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <service id="SwagPublisher\VersionControlSystem\Data\CmsPageDraftDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Data\CmsPageActivityDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

       <service id="SwagPublisher\VersionControlSystem\Data\CmsPageExtension">
            <tag name="shopware.entity.extension"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Data\UserExtension">
            <tag name="shopware.entity.extension"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Data\MediaExtension">
            <tag name="shopware.entity.extension"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway">
            <argument type="service" id="cms_page_draft.repository"/>
            <argument type="service" id="cms_page_activity.repository"/>
            <argument type="service" id="cms_page.repository"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\CommonService">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\DiscardAction">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlService"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CommonService" />
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\DraftAction">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlService"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CommonService" />
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\MergeAction">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlService"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CommonService" />
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\ReleaseAsNewAction">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlService"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CommonService" />
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\PreviewAction">
            <argument type="service" id="Shopware\Core\Content\Cms\SalesChannel\SalesChannelCmsPageLoader"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>
            <argument type="service" id="Shopware\Core\Content\Category\SalesChannel\CategoryRoute"/>
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>

            <tag name="swag.publisher.storefront-action"/>
            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\DuplicateAction">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlService"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CommonService" />
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>
            <argument type="service" id="cms_page.repository"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\UpdateFromLiveVersionAction">
            <argument id="SwagPublisher\VersionControlSystem\Internal\VersionControlService" type="service"/>
            <argument id="SwagPublisher\VersionControlSystem\Internal\CommonService" type="service"/>
            <argument id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway" type="service"/>

            <tag name="controller.service_arguments"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\VersionControlService">
            <argument id="Shopware\Core\Framework\DataAbstractionLayer\DefinitionInstanceRegistry" type="service"/>
            <argument id="SwagPublisher\VersionControlSystem\Internal\VersionFromVersionUpdater" type="service"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\VersionFromVersionUpdater">
            <argument id="Shopware\Core\Framework\DataAbstractionLayer\Write\EntityWriter" type="service"/>
            <argument id="Shopware\Core\Framework\DataAbstractionLayer\DefinitionInstanceRegistry" type="service"/>
            <argument id="version.repository" type="service"/>
            <argument id="version_commit.repository" type="service"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\ActivityLogSubscriber">
            <argument id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway" type="service"/>
            <argument id="cms_page.repository" type="service"/>

            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\PreviewMediaSync">
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\VersionControlCmsGateway"/>

            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\CleanupConfig">
            <factory class="SwagPublisher\VersionControlSystem\Internal\CleanupConfig" method="fromSystemConfig"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
        </service>

        <service id="SwagPublisher\VersionControlSystem\Internal\CleanupTask">
            <tag name="shopware.scheduled.task"/>
        </service>
        <service id="SwagPublisher\VersionControlSystem\Internal\CleanupHandler">
            <argument type="service" id="scheduled_task.repository"/>
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="SwagPublisher\VersionControlSystem\Internal\CleanupConfig"/>

            <tag name="messenger.message_handler"/>
        </service>

        <service id="SwagPublisher\Common\UpdateChangeDetector">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="collection">
                <argument type="string">Shopware\Core\Content\Cms\CmsPageDefinition</argument>
                <argument type="string">Shopware\Core\Content\Cms\Aggregate\CmsSlot\CmsSlotDefinition</argument>
                <argument type="string">Shopware\Core\Content\Cms\Aggregate\CmsSection\CmsSectionDefinition</argument>
                <argument type="string">Shopware\Core\Content\Cms\Aggregate\CmsBlock\CmsBlockDefinition</argument>
                <argument type="string">Shopware\Core\Content\Cms\Aggregate\CmsPageTranslation\CmsPageTranslationDefinition</argument>
                <argument type="string">Shopware\Core\Content\Cms\Aggregate\CmsSlotTranslation\CmsSlotTranslationDefinition</argument>
            </argument>

            <tag name="kernel.event_subscriber"/>
        </service>
    </services>
</container>
