<?xml version="1.0"?>
<psalm
    cacheDirectory="var/cache/psalm"
    findUnusedVariablesAndParams="true"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="https://getpsalm.org/schema/config"
    xsi:schemaLocation="https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd"
    autoloader="vendor/shopware/core/DevOps/StaticAnalyze/PHPStan/phpstan-bootstrap.php"
>
    <projectFiles>
        <directory name="src"/>
        <directory name="tests"/>
        <ignoreFiles>
            <directory name="vendor"/> <!-- would otherwise inspect vendor -->
            <directory name="../../../src/"/> <!-- platform/src -->
            <directory name="../../../vendor/"/> <!-- platform/vendor -->
            <file name="tests/TestBootstrapper.php"/>

            <!-- Compatibility with EnterpriseSearch -->
            <file name="src/ElasticSearch/CategoryEsDefinitionDecorator.php"/>
            <file name="src/ElasticSearch/ProductEsDefinitionDecorator.php"/>
        </ignoreFiles>
    </projectFiles>

    <plugins>
        <pluginClass class="Psalm\SymfonyPsalmPlugin\Plugin"/>
        <pluginClass class="Psalm\PhpUnitPlugin\Plugin"/>
    </plugins>

    <forbiddenFunctions>
        <function name="dump"/>
        <function name="dd"/>
        <function name="var_dump"/>
        <function name="error_log"/>
    </forbiddenFunctions>

    <issueHandlers>
        <PropertyNotSetInConstructor errorLevel="info"/>
        <MissingFile>
            <errorLevel type="info">
                <file name="tests/TestBootstrap.php"/>
            </errorLevel>
        </MissingFile>

        <MoreSpecificImplementedParamType>
            <errorLevel type="info">
                <file name="src/DataAbstractionLayer/*/*Collection.php"/>
            </errorLevel>
        </MoreSpecificImplementedParamType>

        <DeprecatedMethod>
            <errorLevel type="info">
                <referencedMethod name="Doctrine\DBAL\Connection::fetchColumn"/>
                <referencedMethod name="Doctrine\DBAL\Driver\ResultStatement::fetchColumn"/>
                <referencedMethod name="Doctrine\DBAL\Driver\ResultStatement::fetch"/>
                <referencedMethod name="Doctrine\DBAL\Driver\ResultStatement::fetchAll"/>

                <!-- <deprecated> tag:v6.0.0 - remove with minVersion Shopware 6.5 -->
                <referencedMethod name="Shopware\Core\Framework\Struct\ExtendableTrait::addExtension"/>
            </errorLevel>
        </DeprecatedMethod>

        <DeprecatedClass>
            <errorLevel type="info">
                <!-- <deprecated> tag:v6.0.0 - remove with minVersion Shopware 6.5 -->
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Criteria"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\EntitySearchResult"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\IdSearchResult"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Filter\Filter"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Filter\ContainsFilter"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Filter\EqualsFilter"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Filter\EqualsAnyFilter"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Filter\RangeFilter"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Aggregation\Aggregation"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Aggregation\Bucket\TermsAggregation"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Aggregation\Metric\SumAggregation"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\Aggregation\Metric\CountAggregation"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\AggregationResult\AggregationResult"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\AggregationResult\Bucket\Bucket"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\AggregationResult\Bucket\TermsResult"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\AggregationResult\Metric\CountResult"/>
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\AggregationResult\Metric\SumResult"/>
            </errorLevel>
        </DeprecatedClass>

        <DeprecatedInterface>
            <errorLevel type="info">
                <!-- <deprecated> tag:v6.0.0 - remove with minVersion Shopware 6.5 -->
                <referencedClass name="Shopware\Core\Framework\DataAbstractionLayer\Search\CriteriaPartInterface"/>

            </errorLevel>
        </DeprecatedInterface>

        <!-- level 3 issues - slightly lazy code writing, but provably low false-negatives -->

        <InternalMethod errorLevel="info"/>
        <InternalClass errorLevel="info"/>
        <InternalProperty errorLevel="info"/>
        <PropertyNotSetInConstructor errorLevel="info"/>
        <MissingConstructor errorLevel="info"/>
        <UnresolvableInclude errorLevel="info"/>
        <NonInvariantDocblockPropertyType errorLevel="info"/>
    </issueHandlers>
</psalm>

