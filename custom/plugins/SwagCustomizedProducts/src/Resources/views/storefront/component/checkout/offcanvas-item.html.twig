{# @deprecated tag:v5.0.0 - Template is deprecated. Use new line item template. #}
{% sw_extends '@Storefront/storefront/component/checkout/offcanvas-item.html.twig' %}

{% set lineItemTemplateType = constant('Swag\\CustomizedProducts\\Core\\Checkout\\CustomizedProductsCartDataCollector::CUSTOMIZED_PRODUCTS_TEMPLATE_LINE_ITEM_TYPE') %}
{% set lineItemOptionType = constant('Swag\\CustomizedProducts\\Core\\Checkout\\CustomizedProductsCartDataCollector::CUSTOMIZED_PRODUCTS_OPTION_LINE_ITEM_TYPE') %}
{% set lineItemOptionValueType = constant('Swag\\CustomizedProducts\\Core\\Checkout\\CustomizedProductsCartDataCollector::CUSTOMIZED_PRODUCTS_OPTION_VALUE_LINE_ITEM_TYPE') %}
{% set isCustomizedProduct = lineItem.type == lineItemTemplateType %}
{% set cover = null %}

{% block component_offcanvas_cart_item_container %}
    {% if isCustomizedProduct %}
        {% set isNested = false %}
        {% for child in lineItem.children %}
            {% if child.type == 'product' %}
                {% set label = child.label %}
                {% set referencedId = child.referencedId %}
                {% set productNumber = lineItem.payload|merge({ 'productNumber': child.payload.productNumber }) %}

                {% if child.cover.url %}
                    {% set cover = child.cover %}
                {% endif %}

                {% do lineItem.setLabel(label) %}
                {% do lineItem.setCover(cover) %}
                {% do lineItem.setReferencedId(referencedId) %}
                {% do lineItem.setPayload(productNumber) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {{ parent() }}
{% endblock %}

{% block component_offcanvas_product_label %}
    {# Generate proper product headlines for custom products like it's a product #}
    {% if isCustomizedProduct %}
        {% set type = 'product' %}
    {% endif %}

    {{ parent() }}
{% endblock %}

{% block component_offcanvas_product_quantity_form %}
    {{ parent() }}

    {% if isCustomizedProduct or lineItem.type == lineItemOptionType or lineItem.type == lineItemOptionValueType %}
        <div class="cart-item-quantity">
            {{ lineItem.quantity }}
        </div>
    {% endif %}
{% endblock %}

{% block component_offcanvas_children %}
    {% if isCustomizedProduct %}
        {% set isNested = true %}
    {% endif %}

    {{ parent() }}
{% endblock %}
