{# @deprecated tag:v5.0.0 - Template is deprecated. Use new line item template. #}
{% sw_extends '@Storefront/storefront/page/checkout/checkout-item-children.html.twig' %}

{% block page_checkout_item_children_element %}
    {% if lineItem.type != 'customized-products' or nestedLineItem.type != 'product' %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block page_checkout_item_children_element_divider %}
    {% if lineItem.type != 'customized-products' or nestedLineItem.type != 'product' %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block page_checkout_item_children_element_content %}
   {{ parent() }}

    {% if lineItem.type == 'customized-products' %}
        {% set isNested = false %}
        {% set selectionItems = [] %}
        {% if nestedLineItem.payload.type == 'imageupload' or nestedLineItem.payload.type == 'fileupload' %}
            {% for file in nestedLineItem.payload.media %}
                {% set selectionItems = selectionItems|merge([{
                    'label': file.filename,
                    'tag': nestedLineItem|customized_product_price_tag,
                    'type': nestedLineItem.payload.type
                }]) %}
            {% endfor %}
        {% elseif nestedLineItem.payload.type != 'imageselect' and nestedLineItem.payload.type != 'colorselect' and nestedLineItem.payload.type != 'select' %}
            {% if nestedLineItem.payload.type == 'datetime' %}
                {% set itemLabel = nestedLineItem.payload.value|date('d.m.Y', false) %}
            {% elseif nestedLineItem.payload.type == 'timestamp' %}
                {% set itemLabel = nestedLineItem.payload.value|date('H:i', false) %}
            {% elseif nestedLineItem.payload.type == 'checkbox' %}
                {% set itemLabel = nestedLineItem.label %}
            {% elseif nestedLineItem.payload.value is not iterable %}
                {% set itemLabel = nestedLineItem.payload.value %}
            {% endif %}

            {% if itemLabel %}
                {% set selectionItems = selectionItems|merge([{
                    'label': itemLabel,
                    'tag': nestedLineItem|customized_product_price_tag,
                    'type': nestedLineItem.payload.type
                }]) %}
            {% endif %}
        {% endif %}

        {% block customized_product_checkout_item_children_element_content %}
            {% for item in selectionItems %}
                {% block customized_product_checkout_item_children_element_content_value_item %}
                    <div class="row cart-item-children-element">
                        <div class="col cart-item-child-label nesting-level-{{ nestingLevel + 1 }}">
                            <div class="cart-item-child-label-bullet">
                                <div class="swag-fade-container swag-fade-container-shrinked">
                                    {% autoescape false %}
                                        {{ item.label|sw_sanitize }}
                                    {% endautoescape %}
                                </div>
                                <a href="#more" class="swag-fading-link-more swag-fade-link-hidden">more</a>
                                <a href="#less" class="swag-fading-link-less swag-fade-link-hidden">less</a>
                            </div>
                        </div>
                    </div>
                {% endblock %}
            {% endfor %}
        {% endblock %}
    {% endif %}
{% endblock %}


{% block page_checkout_item_child_total_price %}
    {% if lineItem.type == 'customized-products' %}
        {{ nestedLineItem|customized_product_price_tag }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block page_checkout_item_children_header_content_change_button %}
    {% if lineItem.hasExtension(constant('Swag\\CustomizedProducts\\Core\\Checkout\\CustomizedProductsCartDataCollector::CUSTOMIZED_PRODUCT_CONFIGURATION_KEY')) %}
        {% set isChangeable = true %}
        {% set seo = seoUrl('frontend.detail.page', {
                'productId': lineItem.children.first.referencedId,
                'swagCustomizedProductsConfigurationEdit': lineItem.extensions.customizedProductConfiguration.id
            })
        %}

        <a href="{{ seo }}"
           class="order-item-product-name"
           title="{{ label }}">
            {{ parent() }}
        </a>
    {% endif %}
{% endblock %}

