!function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=(window.__sw__.assetPath + '/bundles/rulebuilderpreview/'),t(t.s="uyfW")}({I7up:function(e,r,t){var n=t("mwFi");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t("P8hj").default)("acd7bf88",n,!0,{})},LybB:function(e,r){Shopware.Component.override("sw-condition-type-select",{inject:["getIsRulePreviewEnabled"],computed:{previewEnabled:function(){return this.getIsRulePreviewEnabled()},arrowColor:function(){return!this.disabled&&this.previewEnabled?{primary:"#758CA3",secondary:"#ffffff"}:this.$super("arrowColor")}},methods:{changeType:function(e){if(e){var r="".concat(this.condition.getEntityName(),".").concat(this.condition.id,".type");this.$store.commit("error/removeApiError",{expression:r})}this.$super("changeType",e)}}})},P8hj:function(e,r,t){"use strict";function n(e,r){for(var t=[],n={},i=0;i<r.length;i++){var o=r[i],s=o[0],l={id:e+":"+i,css:o[1],media:o[2],sourceMap:o[3]};n[s]?n[s].parts.push(l):t.push(n[s]={id:s,parts:[l]})}return t}t.r(r),t.d(r,"default",(function(){return v}));var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},s=i&&(document.head||document.getElementsByTagName("head")[0]),l=null,u=0,a=!1,c=function(){},d=null,p="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(e,r,t,i){a=t,d=i||{};var s=n(e,r);return w(s),function(r){for(var t=[],i=0;i<s.length;i++){var l=s[i];(u=o[l.id]).refs--,t.push(u)}r?w(s=n(e,r)):s=[];for(i=0;i<t.length;i++){var u;if(0===(u=t[i]).refs){for(var a=0;a<u.parts.length;a++)u.parts[a]();delete o[u.id]}}}}function w(e){for(var r=0;r<e.length;r++){var t=e[r],n=o[t.id];if(n){n.refs++;for(var i=0;i<n.parts.length;i++)n.parts[i](t.parts[i]);for(;i<t.parts.length;i++)n.parts.push(m(t.parts[i]));n.parts.length>t.parts.length&&(n.parts.length=t.parts.length)}else{var s=[];for(i=0;i<t.parts.length;i++)s.push(m(t.parts[i]));o[t.id]={id:t.id,refs:1,parts:s}}}}function h(){var e=document.createElement("style");return e.type="text/css",s.appendChild(e),e}function m(e){var r,t,n=document.querySelector("style["+p+'~="'+e.id+'"]');if(n){if(a)return c;n.parentNode.removeChild(n)}if(f){var i=u++;n=l||(l=h()),r=y.bind(null,n,i,!1),t=y.bind(null,n,i,!0)}else n=h(),r=S.bind(null,n),t=function(){n.parentNode.removeChild(n)};return r(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;r(e=n)}else t()}}var b,g=(b=[],function(e,r){return b[e]=r,b.filter(Boolean).join("\n")});function y(e,r,t,n){var i=t?"":n.css;if(e.styleSheet)e.styleSheet.cssText=g(r,i);else{var o=document.createTextNode(i),s=e.childNodes;s[r]&&e.removeChild(s[r]),s.length?e.insertBefore(o,s[r]):e.appendChild(o)}}function S(e,r){var t=r.css,n=r.media,i=r.sourceMap;if(n&&e.setAttribute("media",n),d.ssrId&&e.setAttribute(p,r.id),i&&(t+="\n/*# sourceURL="+i.sources[0]+" */",t+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},iTvE:function(e){e.exports=JSON.parse('{"sw-rule-builder-preview":{"preview":"Preview","previewMode":"Preview mode","previewDescription":"Select an order to preview if conditions will return true or false. The preview will not affect the selected order.","order":"Order","orderPlaceholder":"Select order...","dateTime":"Time and date","dateTimeDescription":"The rule must use time-based conditions in order to select time and date for preview.","ruleResultTrue":"This rule returns true","ruleResultFalse":"This rule returns false","ruleResultInvalid":"Waiting..."}}')},lxQM:function(e,r,t){var n=t("wedl");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t("P8hj").default)("85bdfdfc",n,!0,{})},mOnH:function(e){e.exports=JSON.parse('{"sw-rule-builder-preview-indicator":{"true":"Wahr","false":"Falsch","invalid":"..."}}')},mwFi:function(e,r,t){},oLyy:function(e){e.exports=JSON.parse('{"sw-rule-builder-preview":{"preview":"Vorschau","previewMode":"Vorschaumodus","previewDescription":"Wähle eine Bestellung aus, anhand derer ermittelt wird, ob eine Bedingung wahr oder falsch wird. Diese Vorschau hat keine Auswirkungen auf die ausgewählte Bestellung.","order":"Bestellung","orderPlaceholder":"Bestellung auswählen ...","dateTime":"Zeit und Datum","dateTimeDescription":"Die Regel muss zeitbasierte Bedingungen verwenden, um Zeit und Datum für die Vorschau auswählen zu können.","ruleResultTrue":"Diese Regel ist im Ergebnis \\"wahr\\"","ruleResultFalse":"Diese Regel ist im Ergebnis \\"falsch\\"","ruleResultInvalid":"Warte ..."}}')},srJU:function(e,r,t){var n=t("yozt");n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t("P8hj").default)("6173b7c0",n,!0,{})},uyfW:function(e,r,t){"use strict";t.r(r);t("lxQM");var n=t("oLyy"),i=t("iTvE"),o=Shopware.Component,s=Shopware.Data.Criteria,l=Shopware.Utils;o.register("sw-rule-builder-preview",{template:'<div\n    v-if="getLicense(\'RULE_BUILDER-4978012\')"\n    class="sw-rule-builder-preview"\n    :class="ruleBuilderPreviewClasses"\n>\n    <sw-container\n        columns="1fr auto"\n        gap="0px 10px"\n    >\n        <div class="sw-rule-builder-preview__headline">\n            <p v-if="previewModeActive">\n                {{ $tc(\'sw-rule-builder-preview.previewDescription\') }}\n            </p>\n        </div>\n        <sw-switch-field\n            v-model="previewModeActive"\n            :label="$tc(\'sw-rule-builder-preview.previewMode\')"\n        />\n    </sw-container>\n\n    <sw-container\n        v-if="previewModeActive"\n        columns="1fr 1fr"\n        gap="0px 10px"\n    >\n        <sw-entity-single-select\n            v-model="orderId"\n            :placeholder="$tc(\'sw-rule-builder-preview.orderPlaceholder\')"\n            entity="order"\n            :criteria="orderCriteria"\n            label-property="orderNumber"\n            :label="$tc(\'sw-rule-builder-preview.order\')"\n            required\n        >\n            <template #selection-label-property="{ item }">\n                {{ item.orderNumber }}\n                <span>\n                    {{ item.orderCustomer.firstName }} {{ item.orderCustomer.lastName }}\n                </span>\n            </template>\n            <template #result-description-property="{ item, searchTerm, highlightSearchTerm }">\n                <sw-highlight-text\n                    v-if="highlightSearchTerm"\n                    :text="`${item.orderCustomer.firstName} ${item.orderCustomer.lastName}`"\n                    :search-term="searchTerm"\n                />\n            </template>\n        </sw-entity-single-select>\n        <sw-container\n            class="sw-rule-builder-preview__datetime-field"\n            columns="1fr"\n        >\n            <sw-datepicker\n                v-model="dateTime"\n                date-type="datetime-local"\n                :label="$tc(\'sw-rule-builder-preview.dateTime\')"\n                :disabled="!hasTimeCondition"\n            />\n            <span v-if="!hasTimeCondition">{{ $tc(\'sw-rule-builder-preview.dateTimeDescription\') }}</span>\n        </sw-container>\n    </sw-container>\n\n    <sw-rule-builder-preview-indicator\n        condition-name="andContainer"\n        size="medium"\n    >\n        <template #preview-invalid>\n            {{ $tc(\'sw-rule-builder-preview.ruleResultInvalid\') }}\n        </template>\n        <template #preview-true>\n            {{ $tc(\'sw-rule-builder-preview.ruleResultTrue\') }}\n            <sw-icon\n                name="regular-checkmark-s"\n                size="10px"\n            />\n        </template>\n        <template #preview-false>\n            {{ $tc(\'sw-rule-builder-preview.ruleResultFalse\') }}\n            <sw-icon\n                name="regular-times-s"\n                size="10px"\n            />\n        </template>\n    </sw-rule-builder-preview-indicator>\n</div>\n',snippets:{"de-DE":n,"en-GB":i},inject:["ruleBuilderPreviewService"],props:{conditionTree:{type:Object,required:!0},disabled:{type:Boolean,required:!1,default:!1}},data:function(){var e=this;return{orderId:null,dateTime:null,isLoading:!1,previewModeActive:!1,requiredFields:["id","type","value","children","scriptId"],timeRules:["dayOfWeek","timeRange","dateRange","scriptRule"],debouncedResults:l.debounce((function(){e.getResults()}),500,{leading:!0})}},watch:{previewModeActive:function(){this.getResults()},orderId:function(){this.getResults()},dateTime:function(){this.getResults()},conditionTree:{deep:!0,handler:function(){this.debouncedResults()}},previewEnabled:function(e){this.$emit("preview-enabled",e)}},computed:{previewEnabled:function(){return this.previewModeActive&&this.orderId},orderCriteria:function(){var e=new s;return e.addSorting(s.sort("createdAt","DESC",!1)),e},hasTimeCondition:function(){return this.hasConditionOfType(this.conditionTree,this.timeRules)},ruleBuilderPreviewClasses:function(){return{"is--preview-mode-active":this.previewModeActive}}},methods:{getLicense:function(e){return Shopware.License.get(e)},getResults:function(){var e=this;if(this.getLicense("RULE_BUILDER-8759907")){Shopware.Application.getContainer("init").httpClient.get("api/_info/config",{headers:{Accept:"application/vnd.api+json",Authorization:"Bearer ".concat(Shopware.Service("loginService").getToken()),"Content-Type":"application/json","sw-license-toggle":"RULE_BUILDER-8759907"}})}else{if(this.previewEnabled){var r=this.getConditionParameters(this.conditionTree);return this.isLoading=!0,this.ruleBuilderPreviewService.preview(this.orderId,[r],this.dateTime).then((function(r){e.$emit("preview-results",r),e.isLoading=!1})).catch((function(r){var t,n;e.$emit("preview-results",!1),e.isLoading=!1;var i=null==r||null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.errors;i&&Object.values(i).forEach((function(e){var r=e.source.pointer.split("/");""===r[0]&&r.shift(),Shopware.State.dispatch("error/addApiError",{expression:r.join("."),error:new Shopware.Classes.ShopwareError(e)})}))}))}this.$emit("preview-results",null)}},getConditionParameters:function(e){var r=this,t={};return this.requiredFields.forEach((function(n){"children"===n?(t[n]=[],e[n].forEach((function(e){t[n].push(r.getConditionParameters(e))}))):t[n]=e[n]})),t},hasConditionOfType:function(e,r){var t=this;if(r.includes(e.type))return!0;var n=!1;return e.children.forEach((function(e){n||(n=t.hasConditionOfType(e,r))})),n}}});t("I7up");var u=t("mOnH"),a=t("vcQN");function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,r,t){return(r=function(e){var r=function(e,r){if("object"!==c(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===c(r)?r:String(r)}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}Shopware.Component.register("sw-rule-builder-preview-indicator",{template:'<div\n    v-if="previewEnabled"\n    class="sw-rule-builder-preview-indicator"\n    :class="indicatorClasses"\n>\n    <sw-label\n        v-if="ruleMatch === null"\n        variant="warning"\n        size="medium"\n        appearance="pill"\n    >\n        <slot name="preview-invalid">\n            {{ $tc(\'sw-rule-builder-preview-indicator.invalid\') }}\n        </slot>\n    </sw-label>\n    <sw-label\n        v-else-if="ruleMatch"\n        variant="success"\n        size="medium"\n        appearance="pill"\n    >\n        <slot name="preview-true">\n            {{ $tc(\'sw-rule-builder-preview-indicator.true\') }}\n        </slot>\n    </sw-label>\n    <sw-label\n        v-else\n        variant="danger"\n        size="medium"\n        appearance="pill"\n    >\n        <slot name="preview-false">\n            {{ $tc(\'sw-rule-builder-preview-indicator.false\') }}\n        </slot>\n    </sw-label>\n</div>\n',snippets:{"de-DE":u,"en-GB":a},inject:["getRulePreviewResults","getIsRulePreviewEnabled"],props:{conditionName:{type:String,required:!0},conditionId:{type:String,required:!1,default:null},size:{type:String,required:!1,default:"small",validValues:["small","medium"],validator:function(e){return["small","medium"].includes(e)}}},computed:{previewResults:function(){return this.getRulePreviewResults()},previewEnabled:function(){return this.getIsRulePreviewEnabled()},ruleMatch:function(){var e=this;if(!this.previewResults)return null;var r=this.previewResults.filter((function(r){return r.name===e.conditionName&&r.ruleReferenceId===e.conditionId}));return r.hasOwnProperty(0)?r[0].match:null},hasValidationError:function(){return null!==Shopware.State.getters["error/getErrorsForEntity"]("rule_condition",this.conditionId)},indicatorClasses:function(){var e;return d(e={},"sw-rule-builder-preview-indicator--size-".concat(this.size),!0),d(e,"has--error",this.hasValidationError),e}}});Shopware.Component.override("sw-condition-tree",{template:'{% block sw_condition_tree %}\n<div\n    class="sw-condition-tree-override"\n    :class="previewClasses"\n>\n    <sw-rule-builder-preview\n        v-if="displayPreview"\n        :condition-tree="conditionTree"\n        @preview-results="onPreviewResults"\n        @preview-enabled="onPreviewToggle"\n    />\n    {% parent %}\n</div>\n{% endblock %}\n',provide:function(){return{getRulePreviewResults:this.getRulePreviewResults,getIsRulePreviewEnabled:this.getIsRulePreviewEnabled}},data:function(){return{previewEnabled:!1,previewResults:null}},computed:{isLineItemScope:function(){return null!==this.scopes&&1===this.scopes.length&&this.scopes.includes("lineItem")},displayPreview:function(){return"rule_condition"===this.conditionRepository.entityName&&!this.isLineItemScope},previewClasses:function(){return{"is--preview-enabled":this.getIsRulePreviewEnabled()}}},methods:{onPreviewToggle:function(e){this.previewEnabled=e},onPreviewResults:function(e){this.previewResults=e},getRulePreviewResults:function(){return this.previewResults},getIsRulePreviewEnabled:function(){return this.previewEnabled&&null!==this.previewResults}}});t("srJU");Shopware.Component.override("sw-condition-tree-node",{template:'{% block sw_condtion_tree_node %}\n<div class="condition-tree-node-override">\n    {% parent %}\n    <sw-rule-builder-preview-indicator\n        :condition-id="condition.id"\n        :condition-name="condition.type"\n    />\n</div>\n{% endblock %}\n'});t("LybB");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function v(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?f(Object(t),!0).forEach((function(r){w(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function w(e,r,t){return(r=m(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function h(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function m(e){var r=function(e,r){if("object"!==p(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,r||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===p(r)?r:String(r)}function b(e,r){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function g(e){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=S(e);if(r){var i=S(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return y(this,t)}}function y(e,r){if(r&&("object"===p(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R=function(e){!function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&b(e,r)}(o,Shopware.Classes.ApiService);var r,t,n,i=g(o);function o(e,r){var t;return function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,e,r,null,"application/json")).name="ruleBuilderPreviewService",t}return r=o,(t=[{key:"preview",value:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Shopware.License.get("RULE_BUILDER-5423050")?this.httpClient.get("api/_info/me",{headers:v(v({},this.getBasicHeaders()),{},{"sw-license-toggle":"RULE_BUILDER-5423050"})}):this.httpClient.post("_admin/rule-builder-preview/".concat(e),{conditions:r,dateTime:t},{headers:this.getBasicHeaders(n)}).then((function(e){return Shopware.Classes.ApiService.handleResponse(e)}))}}])&&h(r.prototype,t),n&&h(r,n),Object.defineProperty(r,"prototype",{writable:!1}),o}();Shopware.Service().register("ruleBuilderPreviewService",(function(){var e=Shopware.Application.getContainer("init");return new R(e.httpClient,Shopware.Service("loginService"))}))},vcQN:function(e){e.exports=JSON.parse('{"sw-rule-builder-preview-indicator":{"true":"True","false":"False","invalid":"..."}}')},wedl:function(e,r,t){},yozt:function(e,r,t){}});