<div
    class="swag-return-management-return-line-items-grid"
>
    <sw-alert
        v-if="showDiscountWarning"
        variant="warning"
        class="swag-return-management-return-line-items-grid__warning"
    >
       <strong>{{ $tc('swag-return-management.returnItemGrid.discountWarning.textOrderHasDiscount') }}</strong>
            <ul>
                <li v-for="item in discountLineItems">
                    {{ item.label + ": " + getDescription(item) }}
                </li>
            </ul>
        <p>{{ $tc('swag-return-management.returnItemGrid.discountWarning.textCheckRefundAmount') }}</p>
    </sw-alert>

    <sw-container
        class="swag-return-management-return-line-items-grid__actions-container"
        columns="1fr"
    >
        <sw-card-filter
            ref="itemFilter"
            :placeholder="$tc('swag-return-management.returnItemGrid.placeholderSearchBarItem')"
            @sw-card-filter-term-change="onSearchTermChange"
        />
    </sw-container>

    <sw-empty-state
        v-if="orderReturnLineItems.length === 0"
        :title="$tc('swag-return-management.returnItemGrid.textNoItemFound')"
        :absolute="false"
        :show-description="false"
    >
        <template #icon>
            <img
                :src="'/administration/static/img/empty-states/products-empty-state.svg' | asset"
                :alt="$tc('swag-return-management.returnItemGrid.textNoItemFound')"
            >
        </template>
    </sw-empty-state>

    <sw-data-grid
        v-else
        ref="dataGrid"
        class="swag-return-management-return-line-items-grid__data-grid"
        identifier="swag-return-management-line-item-grid"
        :allow-inline-edit="acl.can('order_return.editor')"
        :data-source="orderReturnLineItems"
        :columns="getLineItemColumns"
        :is-loading="isLoading"
        :show-selection="acl.can('order_return.editor')"
        show-settings
        @inline-edit-cancel="onInlineEditCancel"
        @inline-edit-save="onInlineEditSave"
        @selection-change="onSelectionChange"
    >
        <template #column-lineItem.label="{ item }">
            <div
                v-if="isProductItem(item.lineItem)"
                class="swag-return-management-return-line-items-grid__item-product"
            >
                <router-link
                    v-if="item.lineItem.payload && item.lineItem.payload.options"
                    class="swag-return-management-return-line-items-grid__item-payload-options"
                    :to="{ name: 'sw.product.detail', params: { id: item.lineItem.productId } }"
                >
                    <sw-product-variant-info :variations="item.lineItem.payload.options">
                        <div class="swag-return-management-return-line-items-grid__item-label">
                            {{ item.lineItem.label }}
                        </div>
                    </sw-product-variant-info>
                </router-link>

                <template
                    v-else
                    class="swag-return-management-return-line-items-grid__item-payload-options"
                >
                    <span class="swag-return-management-return-line-items-grid__item-label">
                        {{ item.lineItem.label }}
                    </span>
                </template>
            </div>

            <span
                v-else
                class="swag-return-management-return-line-items-grid__item-label"
            >
                {{ item.lineItem.label }}
            </span>
        </template>

        <template #column-state.name="{item}">
            {{ (getItemStatus(item)) }}
        </template>

        <template #column-price.unitPrice="{ item }">
            <span>{{ item.price.unitPrice | currency(order.currency.shortName, order.itemRounding.decimals) }}</span>
        </template>

        <template #column-refundAmount="{ item, isInlineEdit }">
            <sw-number-field
                v-if="isInlineEdit"
                v-model="item.refundAmount"
                :min="0"
                size="small"
            />
            <span v-else>
                {{ item.refundAmount | currency(order.currency.shortName, order.itemRounding.decimals) }}
            </span>

            <sw-help-text
                v-if="showSuggestedPriceHelpText(item)"
                class="swag-return-management-return-line-items-grid__item-price-suggestion"
                :text="getSuggestedPrice(item)"
            />
        </template>

        <template #column-quantity="{ item, isInlineEdit }">
            <sw-number-field
                v-if="isInlineEdit"
                v-model="item.quantity"
                :min="0"
                :max="getItemMaxQuantity(item)"
                @change="(value) => onChangeQuantity(value, item)"
                size="small"
            />
            <span v-else>{{ item.quantity }} x</span>
        </template>

        <template #column-price.taxRules[0]="{ item }">
            <span>
                {{ showTaxValue(item) }}
            </span>
        </template>

        <template #column-price.totalPrice="{ item }">
            <span>{{ item.price.totalPrice | currency(order.currency.shortName, order.itemRounding.decimals) }}</span>
        </template>

        <template #actions="{ item }">
            <sw-context-menu-item
                class="swag-return-management-line-items-grid__show-product"
                :disabled="!isProductItem(item.lineItem)"
                :router-link="{ name: 'sw.product.detail', params: { id: item.lineItem.productId } }"
            >
                {{ $tc('swag-return-management.returnItemGrid.contextMenuShowProduct') }}
            </sw-context-menu-item>

            <sw-context-menu-item
                class="swag-return-management-line-items-grid__open-item-detail"
                @click="onOpenItemDetail(item)"
            >
                {{ $tc('swag-return-management.returnItemGrid.contextMenuOpenReturnDetails') }}
            </sw-context-menu-item>

            <sw-context-menu-item
                v-tooltip.left="{
                    message: $tc('sw-privileges.tooltip.warning'),
                    disabled: acl.can('order_return.editor'),
                    showOnDisabledElements: true
                }"
                class="swag-return-management-line-items-grid__set-status"
                :disabled="!acl.can('order_return.editor')"
                @click="onSetItemStatus(item)"
            >
                {{ $tc('swag-return-management.returnItemGrid.contextMenuSetStatus') }}
            </sw-context-menu-item>

            <sw-context-menu-item
                v-tooltip.left="{
                    message: $tc('sw-privileges.tooltip.warning'),
                    disabled: acl.can('order_return.editor'),
                    showOnDisabledElements: true
                }"
                class="swag-return-management-line-items-grid__remove"
                variant="danger"
                :disabled="!acl.can('order_return.editor')"
                @click="onDeleteItem(item)"
            >
                {{ $tc('swag-return-management.returnItemGrid.contextMenuDelete') }}
            </sw-context-menu-item>

        </template>

        <template #bulk>
            <!-- eslint-disable-next-line vuejs-accessibility/click-events-have-key-events -->
            <a
                class="link link-danger"
                @click="onDeleteItem(null)"
            >
                {{ $tc('global.default.delete') }}
            </a>

            <!-- eslint-disable-next-line vuejs-accessibility/click-events-have-key-events -->
            <a
                class="link link-primary"
                @click="onSetItemStatus(null)"
            >
                {{ $tc('swag-return-management.returnItemGrid.buttonSetStatus') }}
            </a>
        </template>

    </sw-data-grid>

    <swag-return-management-set-item-status-modal
        v-if="showItemStatusModal"
        :line-items="selectedActionItems"
        :excluded-states="excludedStates"
        entity-name="orderReturnLineItem"
        @set-status-success="onSetStatusSuccess"
        @modal-close="onCloseItemStatusModal"
    />

    <swag-return-management-delete-return-item-modal
        v-if="showDeleteReturnItemModal"
        :return-id="returnId"
        :items="selectedActionItems"
        :context="versionContext"
        @item-delete="onDeleteItemSuccess"
        @modal-close="onCloseDeleteReturnItemModal"
    />

    <swag-return-management-item-detail-modal
        v-if="showItemDetailsModal"
        :item="selectedItemOpenDetail"
        @update-item-success="onUpdateItemSuccess"
        @modal-close="onCloseItemDetailModal"
    />
</div>
