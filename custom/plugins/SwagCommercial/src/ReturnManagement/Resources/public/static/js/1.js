(this["webpackJsonpPluginreturn-management"]=this["webpackJsonpPluginreturn-management"]||[]).push([[1],{BIFV:function(e,t,n){},P8hj:function(e,t,n){"use strict";function r(e,t){for(var n=[],r={},a=0;a<t.length;a++){var i=t[a],o=i[0],s={id:e+":"+a,css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}n.r(t),n.d(t,"default",(function(){return p}));var a="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},o=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,u=0,l=!1,d=function(){},m=null,c="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function p(e,t,n,a){l=n,m=a||{};var o=r(e,t);return v(o),function(t){for(var n=[],a=0;a<o.length;a++){var s=o[a];(u=i[s.id]).refs--,n.push(u)}t?v(o=r(e,t)):o=[];for(a=0;a<n.length;a++){var u;if(0===(u=n[a]).refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete i[u.id]}}}}function v(e){for(var t=0;t<e.length;t++){var n=e[t],r=i[n.id];if(r){r.refs++;for(var a=0;a<r.parts.length;a++)r.parts[a](n.parts[a]);for(;a<n.parts.length;a++)r.parts.push(g(n.parts[a]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{var o=[];for(a=0;a<n.parts.length;a++)o.push(g(n.parts[a]));i[n.id]={id:n.id,refs:1,parts:o}}}}function f(){var e=document.createElement("style");return e.type="text/css",o.appendChild(e),e}function g(e){var t,n,r=document.querySelector("style["+c+'~="'+e.id+'"]');if(r){if(l)return d;r.parentNode.removeChild(r)}if(h){var a=u++;r=s||(s=f()),t=R.bind(null,r,a,!1),n=R.bind(null,r,a,!0)}else r=f(),t=I.bind(null,r),n=function(){r.parentNode.removeChild(r)};return t(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;t(e=r)}else n()}}var w,y=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function R(e,t,n,r){var a=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=y(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function I(e,t){var n=t.css,r=t.media,a=t.sourceMap;if(r&&e.setAttribute("media",r),m.ssrId&&e.setAttribute(c,t.id),a&&(n+="\n/*# sourceURL="+a.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},UNGe:function(e,t,n){var r=n("BIFV");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("P8hj").default)("73e0f8c4",r,!0,{})},wR8H:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var r=function(e){return e.OPEN="open",e.SHIPPED="shipped",e.SHIPPED_PARTIALLY="shipped_partially",e.RETURN_REQUESTED="return_requested",e.RETURNED="returned",e.RETURNED_PARTIALLY="returned_partially",e.CANCELLED="cancelled",e}(r||{}),a=function(e){return e.STORNO="storno",e.CREDIT_NOTE="credit_note",e.PARTIAL_CANCELLATION="partial_cancellation",e.INVOICE="invoice",e.DELIVERY_NOTE="delivery_note",e}(a||{})},zBhW:function(e,t,n){"use strict";n.r(t);n("UNGe");var r=n("wR8H"),a=Shopware,i=a.Component,o=a.Mixin,s=a.Utils,u=Shopware.Data.Criteria;t.default=i.wrapComponentConfig({template:'<sw-modal\n    :title="$tc(\'swag-return-management.returnModal.title\')"\n    :subtitle="subtitle"\n    :variant="hasNoItems ? \'default\' : \'large\'"\n    class="swag-return-management-create-return-modal"\n    @modal-close="onCancel"\n>\n    <sw-alert\n        v-if="hasNoItems"\n        variant="info"\n        class="swag-return-management-create-return-modal__warning"\n    >\n        {{ $tc(\'swag-return-management.detail.messageErrorCreateReturnModal\') }}\n    </sw-alert>\n\n    <sw-data-grid\n        v-else\n        class="swag-return-management-create-return-modal-grid"\n        :show-actions="false"\n        :show-selection="false"\n        :data-source="lineItems"\n        :columns="getLineItemColumns"\n    >\n        <template #column-label="{ item }">\n            <router-link\n                v-if="item.payload && item.payload.options"\n                class="swag-return-management-create-return-modal-grid__item-payload-options"\n                :to="{ name: \'sw.product.detail\', params: { id: item.productId } }"\n            >\n                <sw-product-variant-info :variations="item.payload.options">\n                    <div class="swag-return-management-create-return-modal-grid__item-label">\n                        {{ item.label }}\n                    </div>\n                </sw-product-variant-info>\n            </router-link>\n        </template>\n\n        <template #column-returnQuantity="{ item }">\n            <sw-number-field\n                v-model="item.returnQuantity"\n                size="small"\n                :min="0"\n                :max="item.quantity"\n                :disabled="hasReturnLineItems(item) || hasInvalidStates(item) || isNotCreatorPermission"\n            />\n        </template>\n\n        <template #column-comment="{ item }">\n            <sw-text-field\n                v-if="!hasReturnLineItems(item) && !hasInvalidStates(item)"\n                v-model="item.comment"\n                :placeholder="$tc(\'swag-return-management.returnModal.placeholderComment\')"\n                size="small"\n                :disabled="isNotCreatorPermission"\n            />\n            <p v-else>\n                {{ $tc(\'swag-return-management.returnModal.messagePreventAddItem\') }}\n            </p>\n        </template>\n    </sw-data-grid>\n\n    <template #modal-footer>\n        <sw-button\n            class="swag-return-management-create-return-modal-grid__button-cancel"\n            size="small"\n            @click="onCancel"\n        >\n            {{ $tc(\'global.default.cancel\') }}\n        </sw-button>\n\n        <sw-button\n            v-tooltip="tooltipSaveButton"\n            class="swag-return-management-create-return-modal-grid__button-save"\n            size="small"\n            variant="primary"\n            :disabled="hasNoItems || hasNoAvailableItems || isNotCreatorPermission"\n            :is-loading="isLoading"\n            @click="onSave"\n        >\n            {{ orderReturn ? $tc(\'swag-return-management.returnModal.buttonAddItemToReturn\') : $tc(\'swag-return-management.returnModal.buttonCreateReturn\') }}\n        </sw-button>\n    </template>\n</sw-modal>\n',inject:["acl","orderReturnApiService","repositoryFactory"],mixins:[o.getByName("notification")],props:{lineItems:{type:Array,required:!0},order:{type:Object,required:!0}},data:function(){return{isLoading:!1}},computed:{orderReturn:function(){var e,t,n;return null!==(e=null===(t=this.order)||void 0===t||null===(n=t.extensions)||void 0===n?void 0:n.returns[0])&&void 0!==e?e:null},lastChangedUser:function(){var e,t,n=(null===(e=this.orderReturn)||void 0===e?void 0:e.updatedBy)||(null===(t=this.orderReturn)||void 0===t?void 0:t.createdBy)||{},r=n.firstName,a=void 0===r?"":r,i=n.lastName,o=void 0===i?"":i;return"".concat(a," ").concat(o).trim()},subtitle:function(){var e,t;if(!this.orderReturn)return null;var n=s.format.date(this.orderReturn.createdAt,{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit",year:"numeric"});return this.$tc("swag-return-management.returnModal.subtitle",0,{returnNumber:this.orderReturn.returnNumber,state:null===(e=this.orderReturn)||void 0===e||null===(t=e.state)||void 0===t?void 0:t.name,time:n,user:this.lastChangedUser})},getLineItemColumns:function(){return[{property:"label",label:this.$tc("swag-return-management.returnModal.columnName"),allowResize:!1,width:"40%",multiLine:!0},{property:"quantity",label:this.$tc("swag-return-management.returnModal.columnOrderQuantity"),align:"right",width:"10%"},{property:"returnQuantity",label:this.$tc("swag-return-management.returnModal.columnReturnQuantity"),width:"10%"},{property:"comment",label:this.$tc("swag-return-management.returnModal.columnComment"),width:"40%",multiLine:!0}]},hasNoItems:function(){var e;return 0===(null===(e=this.lineItems)||void 0===e?void 0:e.length)},hasNoAvailableItems:function(){var e,t=this;return!(null===(e=this.lineItems)||void 0===e||!e.every((function(e){return t.hasReturnLineItems(e)||t.hasInvalidStates(e)})))},returnRepository:function(){return this.repositoryFactory.create("order_return")},isNotCreatorPermission:function(){return!this.acl.can("order_return.creator")&&!this.orderReturn},tooltipSaveButton:function(){return{disabled:!this.isNotCreatorPermission,showOnDisabledElements:!0,message:this.$tc("sw-privileges.tooltip.warning")}}},methods:{loadReturn:function(){var e=new u;return e.addAssociation("lineItems.lineItem").addAssociation("lineItems.state").addAssociation("createdBy").addAssociation("updatedBy"),this.returnRepository.get(this.orderReturn.id,Shopware.Context.api,e)},hasReturnLineItems:function(e){var t,n;return!(null==e||null===(t=e.extensions)||void 0===t||null===(n=t.returns)||void 0===n||!n.length)},hasInvalidStates:function(e){var t,n;return!![r.b.RETURNED,r.b.RETURNED_PARTIALLY,r.b.CANCELLED].includes(null==e||null===(t=e.extensions)||void 0===t||null===(n=t.state)||void 0===n?void 0:n.technicalName)},onCancel:function(){this.$emit("modal-close")},onSave:function(){var e;this.isLoading=!0;var t=this.lineItems.filter((function(e){return e.returnQuantity>0}));return 0===t.length?(this.createNotificationError({message:this.$tc("swag-return-management.returnModal.messageErrorNoItemHasQuantity")}),void(this.isLoading=!1)):(t=t.map((function(e){return{orderLineItemId:e.id,quantity:e.returnQuantity,internalComment:e.comment}})),null!==(e=this.orderReturn)&&void 0!==e&&e.id?this.addItemsOrderReturn(t):this.createOrderReturn(t))},createOrderReturn:function(e){var t=this;return this.orderReturnApiService.create(this.order.id,{lineItems:e},this.order.versionId).then((function(){t.$emit("return-create")})).catch((function(e){var n,r,a,i=null==e||null===(n=e.response)||void 0===n||null===(r=n.data)||void 0===r||null===(a=r.errors[0])||void 0===a?void 0:a.detail;t.createNotificationError({message:i})})).finally((function(){t.isLoading=!1}))},addItemsOrderReturn:function(e){var t=this;return this.orderReturnApiService.addItems(this.order.id,this.orderReturn.id,{orderLineItems:e},this.order.versionId).then((function(){t.loadReturn().then((function(e){t.$emit("return-added-items",e)}))})).catch((function(e){var n,r,a,i=null==e||null===(n=e.response)||void 0===n||null===(r=n.data)||void 0===r||null===(a=r.errors[0])||void 0===a?void 0:a.detail;t.createNotificationError({message:i})})).finally((function(){t.isLoading=!1}))}}})}}]);