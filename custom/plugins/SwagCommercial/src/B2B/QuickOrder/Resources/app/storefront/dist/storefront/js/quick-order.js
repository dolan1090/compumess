"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["quick-order"],{4610:(t,e,i)=>{var s=i(9068),o=i(6285);class n extends o.Z{init(){this.products=[],this.notFoundProducts=[],this.page=1,this.limit=50,this.duplicatedItem=""}load(){document.$emitter.publish("QuickOrder/onProductsLoaded",{products:this.getProducts()})}addProduct(t){const e=this.products.findIndex((e=>e.id===t.id));if(e<0)return this.updateDuplicatedItem(""),this.products=[t,...this.products],this.page=1,void this.load();const i=parseInt(t.quantity)+parseInt(this.products[e].quantity);this.updateDuplicatedItem(`${t.productNumber} - ${t.name}`),this.products=[...this.products.slice(0,e),{...this.products[e],quantity:i},...this.products.slice(e+1)],this.load()}updateProduct(t){var e;const i=null!==(e=t.oldId)&&void 0!==e?e:t.id,s=this.products.findIndex((t=>t.id===i));s<0||(this.products=[...this.products.slice(0,s),{...this.products[s],...t},...this.products.slice(s+1)],this.duplicatedItem&&this.updateDuplicatedItem(""),this.load())}removeProduct(t){const e=this.products.findIndex((e=>e.id===t));this.products=[...this.products.slice(0,e),...this.products.slice(e+1)],this.duplicatedItem&&this.updateDuplicatedItem(""),0===this.products.length&&this.updateNotFoundProducts([]),this.load()}resetProductList(){this.products=[],this.page=1,this.limit=50,this.notFoundProducts=[],this.duplicatedItem="",this.load()}updateNotFoundProducts(t){this.notFoundProducts=t,this.$emitter.publish("QuickOrder/updateNotFoundProducts",{notFoundProducts:t})}updateDuplicatedItem(t){this.duplicatedItem=t,this.$emitter.publish("QuickOrder/updateDuplicatedItem",{duplicatedItem:t})}updatePagination(t){this.page=t,this.$emitter.publish("QuickOrder/onPageChanged"),this.load()}handleUploadCSVItems(t){this.updateNotFoundProducts(t.errorProducts);const e=this._getProductsFromQuantityMap(t);e&&!e.length||(this.products="add"===t.option?this._mergeItems(this.products,e):e,this.load())}_getProductsFromQuantityMap(t){const{products:e,quantityMapping:i}=t,s=[];return e.forEach((t=>{var e;const{productNumber:o,name:n,id:r,minPurchase:a,calculatedMaxPurchase:d,purchaseSteps:l,childCount:u}=t;let c=i&&i[o]?i[o]:t.quantity;c>d&&(c=d),c<a&&(c=a);let h=n,p="";null!=t&&null!==(e=t.variation)&&void 0!==e&&e.length&&(p=t.variation.map((t=>`${t.group}: ${t.option}`)).join(" | "),h=`${h} (${p})`),void 0!==c&&0===u&&s.push({id:r,productNumber:o,name:h,quantity:c,calculatedMaxPurchase:d,minPurchase:a,purchaseSteps:l})})),s}_mergeItems(t,e=[]){const i=[...e,...t],s={};return i.forEach((t=>{s[t.id]||(s[t.id]=t)})),Object.values(s)}getProducts(){if(!this.limit)return this.products;const t=(this.page-1)*this.limit,e=t+this.limit;return this.products.slice(t,e)}getTotalPages(){return this.limit&&this.products.length?Math.ceil(this.products.length/this.limit):1}}var r,a,d,l=i(8254),u=i(1966),c=i(5659);class h extends o.Z{init(){this._addToCartModal=this.el.querySelector(this.options.addToCartModal),this._buttonAddToCart=this.el.querySelector(this.options.buttonAddToCart),this._buttonConfirmAddToCart=this.el.querySelector(this.options.buttonConfirmAddToCart),this._removeListModal=this.el.querySelector(this.options.removeListModal),this._buttonRemoveList=this.el.querySelector(this.options.buttonRemoveList),this._buttonConfirmRemove=this.el.querySelector(this.options.buttonConfirmRemove),this._buttonUploadCSV=this.el.querySelector(this.options.buttonUploadCSV),this._emptyRow=this.el.querySelector(`.${this.options.emptyItemClassName}`).cloneNode(!0),this._notFoundItemsAlert=this.el.querySelector(this.options.notFoundItemsAlert).cloneNode(!0),this._duplicatedItemAlert=this.el.querySelector(this.options.duplicatedItemAlert).cloneNode(!0),this._client=new l.Z,this._getBaseQuickOrder(),this._registerEvents()}_registerEvents(){this._buttonConfirmAddToCart.addEventListener("click",this._handleAddToCart.bind(this)),this._buttonConfirmRemove.addEventListener("click",this._clearList.bind(this)),document.$emitter.subscribe("QuickOrder/onProductsLoaded",this._renderProductList.bind(this)),this.$emitter.subscribe("QuickOrder/updateNotFoundProducts",this._showNotFoundItems.bind(this)),this.$emitter.subscribe("QuickOrder/updateDuplicatedItem",this._showDuplicatedItem.bind(this)),window.addEventListener("beforeunload",this._beforeUnloadListener.bind(this))}_beforeUnloadListener(t){if(!this._baseQuickOrder.products.length)return;t.preventDefault();const e=this.options.reloadPageMessage;return c.Z.remove(),t.returnValue=e,e}_hideNotFoundItemsAlert(){const t=document.querySelector(this.options.notFoundItemsAlert);t&&!t.classList.contains("d-none")&&t.classList.add("d-none")}_hideDuplicatedItemAlert(){const t=document.querySelector(this.options.duplicatedItemAlert);t&&!t.classList.contains("d-none")&&t.classList.add("d-none")}_showNotFoundItems(t){const e=t.detail.notFoundProducts;if(!e.length)return void this._hideNotFoundItemsAlert();let i=document.querySelector(this.options.notFoundItemsAlert);if(!i){const t=document.querySelector(".quick-order-alert");t.appendChild(this._notFoundItemsAlert.cloneNode(!0)),i=t.querySelector(this.options.notFoundItemsAlert)}i.classList.remove("d-none");i.querySelector(".alert-content-content").textContent=e.join(", "),i.addEventListener("closed.bs.alert",(()=>{this._baseQuickOrder.updateNotFoundProducts([])}))}_showDuplicatedItem(t){const e=t.detail.duplicatedItem;if(!e)return void this._hideDuplicatedItemAlert();let i=document.querySelector(this.options.duplicatedItemAlert);if(!i){const t=document.querySelector(".quick-order-alert");t.appendChild(this._duplicatedItemAlert.cloneNode(!0)),i=t.querySelector(this.options.duplicatedItemAlert)}i.classList.remove("d-none");i.querySelector(".alert-content-content").textContent=e,i.addEventListener("closed.bs.alert",(()=>{this._baseQuickOrder.updateDuplicatedItem("")}))}_clearList(){this._handleRemoveList(),this._hideNotFoundItemsAlert(),this._hideDuplicatedItemAlert()}_handleRemoveList(){this._baseQuickOrder.resetProductList(),bootstrap.Modal.getInstance(this._removeListModal).hide()}_handleAddToCart(){bootstrap.Modal.getInstance(this._addToCartModal).hide(),this._confirmAddToCart()}_onAfterAjaxSubmit(){c.Z.remove(),this._openOffCanvasCarts()}_openOffCanvasCarts(){const t=window.PluginManager.getPluginInstances("OffCanvasCart");u.Z.iterate(t,(t=>this._openOffCanvasCart(t)))}_openOffCanvasCart(t){t.openOffCanvas(this.options.openCartOffCanvasUrl,!1,(()=>{this.$emitter.publish("openOffCanvasCart")}))}_convertArrayToObject(){const t={};return this._baseQuickOrder.products.forEach((e=>{t[e.id]={id:e.id,quantity:e.quantity,referencedId:e.id,stackable:!0,removable:!0,type:"product"}})),t}_confirmAddToCart(){c.Z.create();const t=this._convertArrayToObject();this._client.post(this.options.addToCartUrl,JSON.stringify({lineItems:t}),this._onAfterAjaxSubmit.bind(this))}_renderProductList(t){const e=t.detail.products,i=this.el.querySelector(this.options.productItemsList);if(i.innerHTML="",this._resetEmptyLine(),0===e.length)return this._buttonAddToCart.disabled=!0,this._buttonRemoveList.disabled=!0,void window.PluginManager.initializePlugins();e.map((t=>{const e=this._emptyRow.cloneNode(!0);e.classList.remove(this.options.emptyItemClassName);const s=e.querySelector(this.options.itemNameInput),o=e.querySelector(this.options.itemQuantityInput),n=e.querySelector(this.options.itemQuantityGroup);e.querySelector(this.options.itemAction).classList.remove("d-none"),n.removeAttribute("disabled"),o.tabIndex=0,s.innerHTML=`<strong>${t.productNumber}</strong> - ${t.name}`,o.value=t.quantity,e.setAttribute("data-id",t.id),o.setAttribute("min",t.minPurchase),o.setAttribute("max",t.calculatedMaxPurchase),o.setAttribute("step",t.purchaseSteps),i.appendChild(e)})),window.PluginManager.initializePlugins(),this._buttonAddToCart.disabled=!1,this._buttonRemoveList.disabled=!1}_resetEmptyLine(){this.el.querySelector(`.${this.options.emptyItemClassName}`).replaceWith(this._emptyRow.cloneNode(!0));this.el.querySelector(`.${this.options.emptyItemClassName} ${this.options.itemNameInput}`).focus()}_getBaseQuickOrder(){this._baseQuickOrder=window.PluginManager.getPluginInstanceFromElement(document.querySelector('[data-b2b-base-quick-order="true"]'),"B2bBaseQuickOrder")}}r=h,d={productItemsList:".quick-order-content-list",productItem:".quick-order-line-item",emptyItemClassName:"quick-order-empty-item",buttonConfirmAddToCart:".btn-confirm-add-to-cart",buttonAddToCart:".btn-add-to-cart",buttonRemoveList:".btn-clear-list",buttonConfirmRemove:".btn-confirm-remove",buttonUploadCSV:".btn-csv-upload",addToCartModal:".add-to-cart-modal",removeListModal:".remove-list-modal",notFoundItemsAlert:"#notFoundItemsAlert",duplicatedItemAlert:"#duplicatedItemAlert",itemAction:".quick-order-item-action",itemNameInput:".input-product-name",itemQuantityInput:".input-product-quantity",itemQuantityGroup:".line-item-quantity-group"},(a=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(a="options"))in r?Object.defineProperty(r,a,{value:d,enumerable:!0,configurable:!0,writable:!0}):r[a]=d;var p=i(46),m=i(7906),_=i(4340),b=i(3206);const g="is-active";class v extends _.Z{_onPressEnter(t){if(!(this._iterator<=-1))try{const e=this._getCurrentSelection();t.preventDefault(),e.click()}catch(t){}}_onKeyDown(t){var e;const i=b.Z.querySelector(document,this._parentSelector,!1);if(!i)return;if(this._items=i.querySelectorAll(this._itemSelector),0===this._items.length)return;let s=this._getCurrentSelection();switch(t.key){case"Enter":return void this._onPressEnter(t);case"Tab":case"ArrowDown":t.preventDefault(),this._iterator++;break;case"ArrowUp":if(t.preventDefault(),this._iterator--,i.scrollHeight>i.clientHeight&&0===i.scrollTop&&8===(null===(e=s)||void 0===e?void 0:e.offsetTop))return;break;default:return}this._clampIterator(),u.Z.iterate(this._items,(t=>t.classList.remove(g))),this._getCurrentSelection().classList.add(g),s=this._getCurrentSelection(),"ArrowDown"!==t.key&&"Tab"!==t.key||(i.scrollTop=s.offsetTop-i.offsetTop),"ArrowUp"===t.key&&(i.scrollTop=i.scrollTop-s.clientHeight)}}class y extends o.Z{init(){this._client=new l.Z,this._selectedItem=null,this._buttonRemove=this.el.querySelector(this.options.removeItemButton),this._inputProductField=this.el.querySelector(this.options.itemNameInput),this._inputQuantityField=this.el.querySelector(`.${this.options.itemQuantityInputClassName}`),this._initializeData(),this._getBaseQuickOrder(),this._registerEvents()}_initializeData(){var t,e,i;if(null===(t=this._inputProductField)||void 0===t||!t.textContent)return;const s=null===(e=this._inputProductField)||void 0===e||null===(i=e.textContent)||void 0===i?void 0:i.split(" - ");this._selectedItem={},this._selectedItem.productNumber=s[0],this._selectedItem.name=s[1],this._selectedItem.id=this.el.getAttribute("data-id"),this._handleLimitationQuantity(this._inputQuantityField)}_registerEvents(){this._navigationHelper=new v(this._inputProductField,`.${this.options.searchResultListClassName}`,`.${this.options.searchResultItemClassName}`,!0),this._inputProductField.addEventListener("input",p.Z.debounce(this._handleProductFieldChange.bind(this),this.options.searchWidgetDelay),{capture:!0,passive:!0}),this._buttonRemove.addEventListener("click",this._handleRemoveItem.bind(this),!1),this.el.addEventListener("change",this._handleQuantityChange.bind(this)),document.body.addEventListener("click",this._onBackgroundClick.bind(this))}_handleProductFieldChange(t){const e=t.target.textContent.trim();e&&(this.$emitter.publish("beforeSearch"),this._handleSearchProduct(e,1))}_handleSearchProduct(t,e=1,i=!1){let s=this.el.querySelector(this.options.itemNameContainer),o=this.options.searchProductUrl+"?search="+encodeURIComponent(t);i||this._clearSuggestResults(),o=`${o}&page=${e}`;const n=this.el.querySelector(this.options.itemLoader),r=new m.Z(n);r.create(),this._client.abort(),this._client.get(o,(e=>{if(!e)return;r.remove();const i=JSON.parse(e),o=i.elements;let n=s.querySelector("ul");n||(n=document.createElement("ul"),n.classList.add(this.options.searchResultListClassName),s.appendChild(n)),n.addEventListener("scroll",this._handleOnScroll.bind(this,i,t)),0===o.length?this._renderEmptyResult(s,n):(this._renderResultItem(o,n,t),this._registerEventSelectElement()),this.$emitter.publish("afterSuggest")}))}_renderEmptyResult(t,e){if(t.getElementsByTagName("li").length>1)return;const i=`\n                <li class="no-product">${this.options.noProductFoundSnippet}</li>\n            `;e.insertAdjacentHTML("beforeend",i)}_renderResultItem(t,e,i){t.forEach((t=>{const s=t.options;let o=t.translated.name,n=t.productNumber,r=new RegExp(i,"i");if(s.length>0){o+=` (${s.map((t=>{var e,i,s;return`${null==t||null===(e=t.group)||void 0===e||null===(i=e.translated)||void 0===i?void 0:i.name}: ${null==t||null===(s=t.translated)||void 0===s?void 0:s.name}`})).join(" | ")})`}r.test(o)&&(o=o.replace(r,'<span class="item-search-highlight">$&</span>')),r.test(n)&&(n=n.replace(r,'<span class="item-search-highlight">$&</span>'));const a=`\n                <li class="${this.options.searchResultItemClassName}"\n                    data-min="${t.minPurchase}"\n                    data-step="${t.purchaseSteps}"\n                    data-id="${t.id}"\n                    data-max="${t.calculatedMaxPurchase}"\n                    tabindex="0"\n                ><strong>${n}</strong> - ${o}</li>\n            `;e.insertAdjacentHTML("beforeend",a)}))}_handleOnScroll(t,e,i){let s=i.target;s.scrollTop+s.clientHeight===s.scrollHeight&&s.getElementsByTagName("li").length!==t.total&&this._handleSearchProduct(e,t.page+1,!0)}_registerEventSelectElement(){const t=document.querySelectorAll(`.${this.options.searchResultItemClassName}`);u.Z.iterate(t,(t=>t.addEventListener("click",this._handleClickSelectElement.bind(this))))}_clearSuggestResults(){this._navigationHelper.resetIterator();const t=document.querySelectorAll(`.${this.options.searchResultListClassName}`);u.Z.iterate(t,(t=>{t.removeEventListener("scroll",this._handleOnScroll.bind(this)),t.remove()})),this.$emitter.publish("clearSuggestResults")}_handleRemoveItem(){this._removeProduct(this._selectedItem.id)}_onBackgroundClick(t){t.target.closest(`.${this.options.searchResultListClassName}`)||(this._clearSuggestResults(),this.$emitter.publish("onBackgroundClick"))}_handleClickSelectElement(t){const{searchResultItemClassName:e}=this.options,i=t.target.closest(`.${e}`);if(this._clearSuggestResults(),this._selectedItem){const t={...this._selectedItem};this._updateSelectedItem(i),this._updateProduct({...this._selectedItem,oldId:t.id})}else this._selectedItem={},this._updateSelectedItem(i),this._addNewProduct(this._selectedItem)}_updateSelectedItem(t){this._updateQuantityInput(t),this._selectedItem.id=t.attributes["data-id"].value;const e=t.textContent.split(" - ");this._selectedItem.productNumber=e[0],this._selectedItem.name=e[1]}_updateQuantityInput(t){if(t.hasAttribute("data-min")){var e;const i=t.getAttribute("data-min");this._inputQuantityField.setAttribute("min",i),this._selectedItem.minPurchase=parseInt(i,10),this._inputQuantityField.value=null!==(e=this._inputQuantityField.value)&&void 0!==e?e:i}if(t.hasAttribute("data-step")){const e=t.getAttribute("data-step");this._inputQuantityField.setAttribute("step",e),this._selectedItem.purchaseSteps=parseInt(e,10)}if(t.hasAttribute("data-max")){const e=t.getAttribute("data-max");this._inputQuantityField.setAttribute("max",e),this._selectedItem.calculatedMaxPurchase=parseInt(e,10)}this._handleLimitationQuantity(this._inputQuantityField)}_handleQuantityChange(t){const e=t.target;e.classList.contains(this.options.itemQuantityInputClassName)&&(this._handleLimitationQuantity(e),this._updateProduct(this._selectedItem))}_handleLimitationQuantity(t){const e=parseInt(t.value),i=parseInt(t.getAttribute("min")),s=parseInt(t.getAttribute("max"));t.nextElementSibling.removeAttribute("disabled"),t.previousElementSibling.removeAttribute("disabled"),t.nextElementSibling.tabIndex=0,t.previousElementSibling.tabIndex=0,e>=s&&(t.value=s,t.nextElementSibling.setAttribute("disabled","disabled"),t.nextElementSibling.tabIndex=-1),e<=i&&(t.value=i,t.previousElementSibling.setAttribute("disabled","disabled"),t.previousElementSibling.tabIndex=-1),this._selectedItem.quantity=parseInt(t.value)}_addNewProduct(t){this._baseQuickOrder.addProduct(t)}_updateProduct(t){this._baseQuickOrder.updateProduct(t)}_removeProduct(t){this._baseQuickOrder.removeProduct(t)}_getBaseQuickOrder(){this._baseQuickOrder=window.PluginManager.getPluginInstanceFromElement(document.querySelector('[data-b2b-base-quick-order="true"]'),"B2bBaseQuickOrder")}}!function(t,e,i){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(y,"options",{itemNameInput:".input-product-name",searchResultListClassName:"js-quick-order-result",searchResultItemClassName:"js-quick-order-result-item",removeItemButton:".quick-order-remove-button",itemNameContainer:".quick-order-item-name",itemQuantityInputClassName:"input-product-quantity",itemLoader:".quick-order-item-loader",searchWidgetDelay:250});class f extends o.Z{init(){this.input=this.el.querySelector(this.options.selectors.fileInput),this.uploadContainer=this.el.querySelector(this.options.selectors.uploadContainer),this.uploadContent=this.el.querySelector(this.options.selectors.uploadContent),this.uploadArea=this.el.querySelector(this.options.selectors.uploadArea),this.addButton=this.el.querySelector(this.options.selectors.addButton),this.applyButton=this.el.querySelector(this.options.selectors.applyButton),this.messageElement=this.el.querySelector(`.${this.options.selectors.messageElement}`),this.iconSuccess=this.el.querySelector(this.options.selectors.iconSuccess).innerHTML,this.iconError=this.el.querySelector(this.options.selectors.iconError).innerHTML,this.uploadDuplicatedProducts=this.el.querySelector(this.options.selectors.uploadDuplicatedProducts),this.uploadOptions=this.el.querySelector(this.options.selectors.uploadOptions),this.uploadModalLabel=this.el.querySelector(this.options.selectors.uploadModalLabel),this.uploadTable=this.el.querySelector(this.options.selectors.uploadTable),this.uploadSelection=this.el.querySelector(this.options.selectors.uploadSelection),this.uploadModalDuplicatedTitle=this.el.querySelector(this.options.selectors.uploadModalDuplicatedTitle),this.httpClient=new l.Z,this.isCancel=!1,this.quantityMapping=[],this._getBaseQuickOrder(),this._registerEvents()}_registerEvents(){this.removeButton=this.uploadArea.querySelector(this.options.selectors.removeButton),this.input.addEventListener("change",this._onFileInputChanged.bind(this)),this.removeButton.addEventListener("click",this._removeFileUpload.bind(this)),this.el.addEventListener("hide.bs.modal",this._closeModal.bind(this)),this.el.addEventListener("show.bs.modal",this._openModal.bind(this)),this.addButton.addEventListener("click",this._addProducts.bind(this)),this.applyButton.addEventListener("click",this._finalResult.bind(this))}_removeFileUpload(){this.httpClient.abort(),this.messageElement.innerHTML="",this.uploadArea.hidden=!1,this._endUpload()}_closeModal(){this.uploadModalDuplicatedTitle.hidden=!0,this.uploadDuplicatedProducts.hidden=!0,this.uploadOptions.hidden=!0,this.applyButton.hidden=!0,this.addButton.hidden=!1,this.responseData=null,this.duplicatedProducts=null,this.checkedRadio=null,this.uploadSelection.innerHTML="";const t=this.uploadTable.querySelector("tbody"),e=this.uploadOptions.querySelector('input[type="radio"]');t&&this.uploadTable.removeChild(t),e&&(e.checked=!0),this._removeFileUpload()}_openModal(){this._baseQuickOrder.products.length>0&&(this.manualProducts=this._baseQuickOrder.products,this.uploadOptions.hidden=!1)}_onFileInputChanged(t){this._startUpload();const e=t.target.files.length>0?t.target.files[0]:null;this._handleFileUpload(e),this.input.value=""}_handleFileUpload(t=null){if(!t||"text/csv"!==t.type||t.size>104857600)return this._handleMessage(this.iconError,this._getSnippet("error"),this.options.selectors.messageErrorState);this._successUpload(t)}_generateUploadElement(t){const e=document.createElement("div");return e.setAttribute("class",this.options.selectors.uploadElement),e.innerHTML=t,e}_startUpload(){this.messageElement.innerHTML="",this.messageElement.classList.forEach((t=>{t.includes(`${this.options.selectors.messageElement}--`)&&this.messageElement.classList.remove(t)})),this.uploadElement&&(this.uploadContent.removeChild(this.uploadElement),this.uploadElement=null),this.uploadElement=this._generateUploadElement(this._getSnippet("loading")),this.uploadContent.appendChild(this.uploadElement),this.uploadContainer.classList.add(this.options.selectors.modifierUploadState)}_endUpload(){this.addButton.disabled=!0,this.input.disabled=!1,this.uploadElement&&(this.uploadContent.removeChild(this.uploadElement),this.uploadElement=null),this.uploadContainer.classList.remove(this.options.selectors.modifierUploadState),this.uploadContainer.classList.remove(this.options.selectors.modifierUploadSuccessState)}_successUpload(t){this._endUpload(),this.uploadElement=this._generateUploadElement(t.name),this.fileUpload=t,this.input.disabled=!0,this.addButton.disabled=!1,this.uploadContent.appendChild(this.uploadElement),this.uploadContainer.classList.add(this.options.selectors.modifierUploadSuccessState)}_handleMessage(t,e,i){this._endUpload();const s=document.createElement("div"),o=document.createElement("div");this.messageElement.classList.add(i),s.setAttribute("class",this.options.selectors.messageText),s.textContent=e,o.setAttribute("class",this.options.selectors.messageIcon),o.innerHTML=t,this.messageElement.appendChild(o),this.messageElement.appendChild(s)}_finalResult(){if(!this.uploadTable.tBodies.length)return!1;this.responseData.quantityMapping={};const t=this.uploadTable.tBodies[0].rows;Array.from(t).forEach((t=>{const e=t.querySelector(".quick-order-upload__product-number").textContent,i=t.querySelector(".form-check-input:checked").value;this.responseData.quantityMapping[e]=Number(i)})),this.uploadCSVItem(this.responseData)}_findDuplicatedProducts(t,e){const i=[];return t.forEach((t=>{const s=t.productNumber;s in e&&i.push({productNumber:s,name:t.name,csvQuantity:e[s],manualQuantity:parseInt(t.quantity)})})),i}_createDuplicatedStructure(t){const e=document.createElement("tbody");t.forEach((t=>{const i=`\n                <tr>\n                    <td>\n                        <div class="quick-order-upload__product-name">\n                            <span class="quick-order-upload__product-number">${t.productNumber}</span>\n                            <span>${t.name}</span>\n                        </div>\n                    </td>\n                    <td>${this._createRadioInput(t.productNumber,t.manualQuantity,"manual",!0)}</td>\n                    <td>${this._createRadioInput(t.productNumber,t.csvQuantity,"csv")}</td>\n                    <td>${this._createRadioInput(t.productNumber,t.csvQuantity+t.manualQuantity,"combined")}</td>\n                </tr>\n            `;e.insertAdjacentHTML("beforeend",i);const s=`\n                <label class="quick-order-upload__product-name">\n                    <span class="quick-order-upload__product-number">${t.productNumber}</span>\n                    <span>${t.name}</span>\n                </label>\n                <select name="${t.productNumber}" class="form-select">\n                    <option value="${t.csvQuantity}" id="${t.productNumber}-csv">\n                        ${this._getSnippet("csv")+" ("+t.csvQuantity+")"}\n                    </option>\n                    <option value="${t.csvQuantity+t.manualQuantity}" id="${t.productNumber}-combined">\n                        ${this._getSnippet("combined")} (${t.csvQuantity+t.manualQuantity})\n                    </option>\n                    <option value="${t.manualQuantity}" id="${t.productNumber}-manual">\n                        ${this._getSnippet("current")+" ("+t.manualQuantity+")"}\n                    </option>\n                </select>\n            `;this.uploadSelection.insertAdjacentHTML("beforeend",s)})),this.uploadTable.appendChild(e);const i=this.uploadTable.querySelectorAll('input[type="radio"]');Array.from(i).forEach((t=>{t.addEventListener("click",(()=>{this.uploadSelection.querySelector(`select[name="${t.name}"] #${t.id}`).selected=!0}))}));const s=this.uploadSelection.querySelectorAll("select");Array.from(s).forEach((t=>{t.addEventListener("change",(t=>{const e=t.target.selectedOptions[0];this.uploadTable.querySelector(`input[type="radio"][id="${e.id}"]`).checked=!0}))}))}_createRadioInput(t,e,i,s=!1){const o=`${t}-${i}`;return`\n            <div class="form-check">\n                <input\n                    type="radio"\n                    class="form-check-input"\n                    id="${o}"\n                    name="${t}"\n                    value="${e}"\n                    ${s?"checked":""}\n                >\n                <label class="form-check-label" for="${o}">${e}</label>\n            </div>\n        `}_uploadRequestCallback(t){let e={};try{e=JSON.parse(t)}catch(t){return this._handleMessage(this.iconError,this._getSnippet("error"),this.options.selectors.messageErrorState),!1}return this.checkedRadio&&(e.option=this.checkedRadio.value),this.checkedRadio&&"add"===this.checkedRadio.value&&(this.quantityMapping=this._getProductNumberQuantityMapping(e.products),this.duplicatedProducts=this._findDuplicatedProducts(this.manualProducts,this.quantityMapping)),this.duplicatedProducts&&this.duplicatedProducts.length>0?(this.uploadArea.hidden=!0,this.uploadOptions.hidden=!0,this.addButton.hidden=!0,this.uploadDuplicatedProducts.hidden=!1,this.applyButton.hidden=!1,this.uploadModalDuplicatedTitle.hidden=!1,this.responseData=e,void this._createDuplicatedStructure(this.duplicatedProducts)):(this.uploadCSVItem(e),!0)}uploadCSVItem(t){this.fileUpload=null,bootstrap.Modal.getInstance(this.el).hide(),this._baseQuickOrder.handleUploadCSVItems(t)}_addProducts(){if(!this.uploadOptions.hidden){const t=this.uploadOptions.querySelectorAll('input[type="radio"]');for(let e=0;e<t.length;e++)if(t[e].checked){this.checkedRadio=t[e];break}}this.addButton.disabled=!0;const t=new FormData;t.append("file",this.fileUpload),this.httpClient.post("/account/quick-order/upload",t,this._uploadRequestCallback.bind(this))}_getSnippet(t){return this.options.snippets?this.options.snippets[t]:""}_getProductNumberQuantityMapping(t=[]){const e={};return t.forEach((t=>{e[t.productNumber]=t.quantity})),e}_getBaseQuickOrder(){this._baseQuickOrder=window.PluginManager.getPluginInstanceFromElement(document.querySelector('[data-b2b-base-quick-order="true"]'),"B2bBaseQuickOrder")}}!function(t,e,i){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(f,"options",{selectors:{fileInput:".quick-order-upload__input",uploadArea:".quick-order-upload",uploadElement:"quick-order-upload__uploading",uploadContainer:".quick-order-upload__container",modifierUploadState:"quick-order-upload__container--uploading",modifierUploadSuccessState:"quick-order-upload__container--success",messageElement:"quick-order-upload__message",messageIcon:"quick-order-upload__message-icon",messageText:"quick-order-upload__message-text",messageErrorState:"quick-order-upload__message--error",messageSuccessState:"quick-order-upload__message--success",iconSuccess:".quick-order-upload__icon-success",iconError:".quick-order-upload__icon-error",selectButton:".quick-order-upload__btn-select",uploadContent:".quick-order-upload__content",removeButton:".quick-order-upload__btn-remove",addButton:".quick-order-upload__btn-add",applyButton:".quick-order-upload__btn-apply",uploadModal:"#quickOrderUploadModal",uploadModalLabel:"#quickOrderUploadModalLabel",uploadOptions:".quick-order-upload__options",uploadDuplicatedProducts:".quick-order-upload__duplicated-products",uploadTable:".quick-order-upload__table",uploadSelection:".quick-order-upload__selection",uploadModalDuplicatedTitle:".quick-order-upload__duplicated-title"}});class S extends o.Z{init(){this._pageFirstButton=this.el.querySelector(this.options.pageFirstButton),this._pagePrevButton=this.el.querySelector(this.options.pagePrevButton),this._pageLastButton=this.el.querySelector(this.options.pageLastButton),this._pageNextButton=this.el.querySelector(this.options.pageNextButton),this._initButtons(),this._getBaseQuickOrder(),this._registerEvents()}_registerEvents(){document.$emitter.subscribe("QuickOrder/onProductsLoaded",this._renderPagination.bind(this))}_initButtons(){this.buttons=b.Z.querySelectorAll(this.el,".pagination input[type=radio]",!1),this._registerButtonEvents()}_registerButtonEvents(){this.buttons.forEach((t=>{t.addEventListener("change",this._onChangePage.bind(this))}))}_unregisterButtonEvents(){this.buttons.forEach((t=>{t.removeEventListener("change",this._onChangePage.bind(this))}))}_onChangePage(t){this._baseQuickOrder.updatePagination(parseInt(t.target.value,10))}_renderPagination(){const t=this._baseQuickOrder.getTotalPages(),e=this._baseQuickOrder.page;if(t<e)return void this._baseQuickOrder.updatePagination(t);if(t<=1)return void this.el.classList.add("d-none");this.el.classList.remove("d-none");const{start:i,end:s}=this._getStartEndPages(e,t),o=1===e,n=e===t;this._setButtonValue(this._pagePrevButton,o?1:e-1),this._setButtonValue(this._pageNextButton,n?t:e+1),this._setButtonValue(this._pageLastButton,t),this._enableButtons([this._pageFirstButton,this._pagePrevButton,this._pageLastButton,this._pageNextButton]),o&&this._disableButtons([this._pageFirstButton,this._pagePrevButton]),n&&this._disableButtons([this._pageLastButton,this._pageNextButton]);const r=this.el.querySelector("ul");r.innerHTML="",this._unregisterButtonEvents(),r.insertAdjacentHTML("beforeend",this._pageFirstButton.outerHTML),r.insertAdjacentHTML("beforeend",this._pagePrevButton.outerHTML);for(let t=i;t<=s;t++){const i=t===e,s=`\n                <li class="page-item page-number ${i?"active":""}">\n                    <input type="radio"\n                           name="p"\n                           id="p${t}"\n                           value="${t}"\n                           class="d-none"\n                           title="pagination"\n                           ${i?"checked":""}>\n                    <label class="page-link" for="p${t}">${t}</label>\n                </li>\n            `;r.insertAdjacentHTML("beforeend",s)}r.insertAdjacentHTML("beforeend",this._pageNextButton.outerHTML),r.insertAdjacentHTML("beforeend",this._pageLastButton.outerHTML),this._initButtons()}_disableButtons(t){t.forEach((t=>{t.setAttribute("disabled","disabled"),t.querySelector("input").setAttribute("disabled","disabled")}))}_enableButtons(t){t.forEach((t=>{t.removeAttribute("disabled"),t.querySelector("input").removeAttribute("disabled")}))}_setButtonValue(t,e){t.querySelector("input").value=e}_getStartEndPages(t,e){let i=t-2;i<=0&&(i=t-1),i<=0&&(i=t);let s=i+4;return s>e&&(s=e),{start:i,end:s}}_getBaseQuickOrder(){this._baseQuickOrder=window.PluginManager.getPluginInstanceFromElement(document.querySelector('[data-b2b-base-quick-order="true"]'),"B2bBaseQuickOrder")}}!function(t,e,i){(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var s=i.call(t,e||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i}(S,"options",{pageFirstButton:".page-first",pagePrevButton:".page-prev",pageLastButton:".page-last",pageNextButton:".page-next"}),s.Z.register("B2bBaseQuickOrder",n,"[data-b2b-base-quick-order]"),s.Z.register("B2bQuickOrderList",h,"[data-b2b-quick-order-list]"),s.Z.register("B2bQuickOrderItem",y,"[data-b2b-quick-order-item]"),s.Z.register("B2bQuickOrderUploadModal",f,"[data-b2b-quick-order-upload-modal]"),s.Z.register("B2bQuickOrderPagination",S,"[data-b2b-quick-order-pagination]")}},t=>{t.O(0,["vendor-node","vendor-shared"],(()=>{return e=4610,t(t.s=e);var e}));t.O()}]);