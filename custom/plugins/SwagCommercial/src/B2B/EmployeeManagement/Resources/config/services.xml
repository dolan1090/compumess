<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <service id="Shopware\Commercial\B2B\EmployeeManagement\Entity\Employee\EmployeeDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Entity\BusinessPartner\BusinessPartnerDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Entity\Role\RoleDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Entity\Permission\PermissionDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Entity\Employee\Aggregate\OrderEmployeeDefinition">
            <tag name="shopware.entity.definition"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Extension\CustomerExtension">
            <tag name="shopware.entity.extension"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Extension\OrderExtension">
            <tag name="shopware.entity.extension"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Registration\CustomerGroupRegistrationSubscriber">
            <argument type="service" id="b2b_business_partner.repository"/>
            <argument type="service" id="customer_specific_features.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Flow\BusinessEventCollectorSubscriber">
            <argument type="service" id="Shopware\Core\Framework\Event\BusinessEventCollector"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\LogoutSubscriber">
            <argument type="service" id="Symfony\Component\HttpFoundation\RequestStack"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\SalesChannelContextRestoredSubscriber">
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="request_stack"/>
            <argument type="service" id="Shopware\Core\Checkout\Customer\SalesChannel\LogoutRoute"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\RolePermissionsValidateSubscriber">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Permission\PermissionEventCollector"/>
            <argument type="service" id="b2b_permission.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\PreWriteValidationEventSubscriber">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmailValidationService"/>
            <argument type="service" id="customer.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Checkout\CartConverter">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Checkout\OrderRouteRequestSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Annotation\B2bEmployeePermissionValidator">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Annotation\B2bRouteParamsCleanupListener">
            <tag name="kernel.event_listener"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\RouteAccess\B2bRouteBlocker">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\RouteAccess\EmployeeRouteAccessLoader"/>
            <tag name="kernel.event_listener" event="kernel.controller" method="blockRouteForEmployee" priority="-20"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\RouteAccess\AccountProfileSubscriber">
            <argument type="service" id="b2b_components_role.repository"/>
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\DecoratedLoginRoute" decorates="Shopware\Core\Checkout\Customer\SalesChannel\LoginRoute" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\DecoratedLoginRoute.inner"/>
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="Shopware\Core\System\SalesChannel\Context\CartRestorer"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="request_stack"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\DecoratedSendPasswordRecoveryMailRoute" decorates="Shopware\Core\Checkout\Customer\SalesChannel\SendPasswordRecoveryMailRoute" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\DecoratedSendPasswordRecoveryMailRoute.inner"/>
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Checkout\DecoratedOrderRoute" decorates="Shopware\Core\Checkout\Order\SalesChannel\OrderRoute" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Checkout\DecoratedOrderRoute.inner"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Controller\BusinessPartnerAccountController" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Employee\List\EmployeeListPageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Employee\Detail\EmployeeDetailPageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\EmployeeRoute"/>
            <argument type="service" id="Shopware\Storefront\Page\Account\Profile\AccountProfilePageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\EmployeeRecoveryIsExpiredRoute"/>
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\EmployeeConfirmPasswordRoute"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\EmployeeRecoverPasswordPageLoader"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <call method="setTwig">
                <argument type="service" id="twig"/>
            </call>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Controller\RoleController" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Role\List\RoleListPageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Role\Detail\RoleDetailPageLoader"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\RoleRoute"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <call method="setTwig">
                <argument type="service" id="twig"/>
            </call>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\EmployeeController" public="true">
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="customer.repository"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Registration\EmployeeInviteService"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmailValidationService"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
            <argument type="service" id="event_dispatcher"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\PermissionController" public="true">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Permission\PermissionEventCollector"/>
            <call method="setContainer">
                <argument type="service" id="service_container"/>
            </call>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\EmployeeRecoverPasswordPageLoader">
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\EmployeeRecoveryIsExpiredRoute"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Recovery\EmployeeRecoveryIsExpiredRoute" public="true">
            <argument type="service" id="b2b_employee.repository"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Login\EmployeeConfirmPasswordRoute" public="true">
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
            <argument type="service" id="Shopware\Core\Framework\Validation\DataValidator"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\EmployeeRoute" public="true">
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="Shopware\Core\Framework\Validation\DataValidator"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmployeeValidationFactory"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Registration\EmployeeInviteService"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmployeeValidationFactory" />

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Employee\List\EmployeeListPageLoader">
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\EmployeeRoute"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Employee\Detail\EmployeeDetailPageLoader">
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\EmployeeRoute"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\RoleRoute"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\RoleRoute" public="true">
            <argument type="service" id="b2b_components_role.repository"/>
            <argument type="service" id="b2b_business_partner.repository"/>
            <argument type="service" id="Shopware\Core\Framework\Validation\DataValidator"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\RoleValidationFactory"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\BusinessPartnerValidationFactory"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\RoleValidationFactory"/>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Role\List\RoleListPageLoader">
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\RoleRoute"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmailValidationService">
            <argument type="service" id="Doctrine\DBAL\Connection"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\Page\Role\Detail\RoleDetailPageLoader">
            <argument type="service" id="Shopware\Storefront\Page\GenericPageLoader"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\RoleRoute"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\PermissionRoute"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Api\Controller\PermissionRoute" public="true">
            <argument type="service" id="b2b_permission.repository"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Permission\PermissionEventCollector"/>
            <argument type="service" id="Shopware\Core\Framework\Validation\DataValidator"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\PermissionValidationFactory"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\PermissionValidationFactory"/>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\BusinessPartnerValidationFactory"/>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Permission\B2bBusinessPartnerResolver">
            <tag name="controller.argument_value_resolver" priority="1002"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Storefront\TwigExtension\B2bEmployeeTwigExtension">
            <tag name="twig.extension"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Flow\EmployeeStorer">
            <argument type="service" id="b2b_employee.repository"/>
            <tag name="flow.storer"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\DecoratedCustomerEmailUniqueValidator" decorates="Shopware\Core\Checkout\Customer\Validation\Constraint\CustomerEmailUniqueValidator">
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\DecoratedCustomerEmailUniqueValidator.inner"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Validation\EmailValidationService"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Permission\PermissionEventCollector">
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="b2b_permission.repository"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\Registration\EmployeeInviteService">
            <argument type="service" id="customer.repository"/>
            <argument type="service" id="b2b_employee.repository"/>
            <argument type="service" id="Symfony\Component\EventDispatcher\EventDispatcherInterface"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Domain\RouteAccess\EmployeeRouteAccessLoader"/>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Command\EmployeeManagementDemodataRequestCreatedSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\B2B\EmployeeManagement\Generator\EmployeeGenerator">
            <argument type="service" id="Shopware\Core\Framework\DataAbstractionLayer\Write\EntityWriter"/>
            <argument type="service" id="Shopware\Commercial\B2B\EmployeeManagement\Entity\Employee\EmployeeDefinition"/>
            <argument type="service" id="Shopware\Core\Checkout\Customer\CustomerDefinition"/>
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="Shopware\Core\System\NumberRange\ValueGenerator\NumberRangeValueGeneratorInterface"/>

            <tag name="shopware.demodata_generator" option-name="employee-management-data" option-default="10"/>
        </service>
    </services>
</container>
