<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <service class="Shopware\Core\Checkout\Cart\CartRuleLoader" id="subscription.cart.rule_loader">
            <argument type="service" id="Shopware\Core\Checkout\Cart\CartPersister"/>
            <argument type="service" id="subscription.cart.processor"/>
            <argument type="service" id="logger"/>
            <argument type="service" id="cache.object"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\RuleLoader"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\Tax\TaxDetector"/>
            <argument type="service" id="Doctrine\DBAL\Connection"/>
            <argument type="service" id="subscription.cart.factory"/>

            <tag name="kernel.reset" method="reset"/>
        </service>

        <service class="Shopware\Core\Checkout\Cart\Validator" id="subscription.cart.validator.collection">
            <argument type="tagged" tag="subscription.cart.validator"/>
        </service>

        <service class="Shopware\Core\Checkout\Cart\CartFactory" id="subscription.cart.factory">
            <argument type="service" id="event_dispatcher"/>
            <argument>subscription</argument>
        </service>

        <service class="Shopware\Core\Checkout\Cart\Processor" id="subscription.cart.processor">
            <argument type="service" id="subscription.cart.validator.collection"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\Price\AmountCalculator"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\Transaction\TransactionProcessor"/>
            <argument type="tagged" tag="subscription.cart.processor"/>
            <argument type="tagged" tag="subscription.cart.collector"/>
            <argument type="service" id="Shopware\Core\Framework\Script\Execution\ScriptExecutor"/>
        </service>

        <service class="Shopware\Core\Checkout\Cart\CartCalculator" id="subscription.cart.calculator">
            <argument type="service" id="subscription.cart.rule_loader"/>
        </service>

        <service class="Shopware\Core\System\SalesChannel\Context\CartRestorer" id="subscription.cart.restorer">
            <argument type="service" id="Shopware\Core\System\SalesChannel\Context\SalesChannelContextFactory"/>
            <argument type="service" id="Shopware\Core\System\SalesChannel\Context\SalesChannelContextPersister"/>
            <argument type="service" id="subscription.cart.service"/>
            <argument type="service" id="subscription.cart.rule_loader"/>
            <argument type="service" id="event_dispatcher"/>
        </service>

        <service class="Shopware\Core\Checkout\Cart\SalesChannel\CartService" id="subscription.cart.service" public="true" lazy="true">
            <argument type="service" id="Shopware\Core\Checkout\Cart\CartPersister"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="subscription.cart.calculator"/>
            <argument type="service" id="subscription.cart.route.load"/>
            <argument type="service" id="subscription.cart.route.delete"/>
            <argument type="service" id="subscription.cart.route.line-item.add"/>
            <argument type="service" id="subscription.cart.route.line-item.update"/>
            <argument type="service" id="subscription.cart.route.line-item.remove"/>
            <argument type="service" id="subscription.cart.route.order"/>
            <argument type="service" id="subscription.cart.factory"/>

            <tag name="kernel.reset" method="reset"/>
        </service>

        <service class="Shopware\Core\Checkout\Order\SalesChannel\OrderService" id="subscription.order.service">
            <argument type="service" id="Shopware\Core\Framework\Validation\DataValidator"/>
            <argument type="service" id="Shopware\Core\Checkout\Order\Validation\OrderValidationFactory"/>
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="subscription.cart.service"/>
            <argument type="service" id="payment_method.repository"/>
            <argument type="service" id="Shopware\Core\System\StateMachine\StateMachineRegistry"/>
            <argument type="service" id="order.repository"/>
            <argument type="service" id="mail_template.repository"/>
            <argument type="service" id="document.repository"/>
            <argument type="service" id="Shopware\Core\Content\Mail\Service\MailService"/>
            <argument type="service" id="sales_channel.repository"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\SubscriptionTransformer">
            <argument type="service" id="event_dispatcher"/>
            <argument type="service" id="Shopware\Core\System\NumberRange\ValueGenerator\NumberRangeValueGeneratorInterface"/>
            <argument type="service" id="Shopware\Commercial\Subscription\Interval\IntervalCalculator"/>
            <argument type="service" id="Shopware\Core\System\StateMachine\Loader\InitialStateIdLoader"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\SubscriptionCartSubscriber">
            <argument type="service" id="Shopware\Core\Checkout\Cart\CartPersister"/>
            <argument type="service" id="Shopware\Commercial\Subscription\Framework\Routing\Mapping\SubscriptionCartMappingResolver"/>
            <argument type="service" id="Shopware\Commercial\Subscription\Interval\IntervalCalculator"/>
            <argument type="service" id="request_stack"/>
            <argument type="service" id="Shopware\Core\System\SalesChannel\Context\SalesChannelContextPersister"/>
            <argument type="service" id="Shopware\Commercial\Subscription\Checkout\Cart\SubscriptionTransformer"/>

            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Order\SubscriptionCheckoutFinishSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Payment\SubscriptionPaymentSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\Event\SubscriptionOrderPlacedCriteriaSubscriber">
            <tag name="kernel.event_subscriber"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\SubscriptionCollector">
            <argument type="service" id="Doctrine\DBAL\Connection"/>

            <tag name="kernel.reset" method="reset"/>
            <tag name="subscription.cart.collector"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Entity\Subscription\Aggregate\SubscriptionStateHandler">
            <argument type="service" id="Shopware\Core\System\StateMachine\StateMachineRegistry"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\SubscriptionPaymentTransactionStructFactory" decorates="Shopware\Core\Checkout\Payment\Cart\PaymentTransactionStructFactory">
            <argument type="service" id=".inner"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\Discount\SubscriptionDiscountCalculator">
            <argument type="service" id="Shopware\Core\Checkout\Cart\Price\PercentagePriceCalculator"/>
        </service>

        <service id="Shopware\Commercial\Subscription\Checkout\Cart\Discount\SubscriptionDiscountProcessor">
            <argument type="service" id="Shopware\Commercial\Subscription\Checkout\Cart\Discount\SubscriptionDiscountCalculator"/>
            <argument type="service" id="translator" />

            <tag name="subscription.cart.processor" />
        </service>
    </services>
</container>
